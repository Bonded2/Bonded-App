var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{g as jsxRuntimeExports,u as useNavigate,r as reactExports}from"./vendor-e6e658b6.js";import{A as ArrowBack}from"./ArrowBack-2a597d17.js";import{E as EditProfileModal}from"./EditProfileModal-0f601799.js";import icpUserService from"./icpUserService-71066c08.js";import{C as CustomTextField}from"./CustomTextField-dcd5565c.js";import"./icp-sdk-b71c0736.js";import"./locationService-2b51ac9f.js";import"./icpCanisterService-30902200.js";import"./index-ed0f0e28.js";const LoadingSkeleton=__name(({type="text",lines=3,width="100%",height="16px",className="",animate=!0})=>{const baseClass=`loading-skeleton ${animate?"animate":""} ${className}`;return type==="text"?jsxRuntimeExports.jsx("div",{className:"loading-skeleton-container",children:Array.from({length:lines}).map((_,index)=>jsxRuntimeExports.jsx("div",{className:baseClass,style:{width:index===lines-1?"70%":width,height,marginBottom:"8px"}},index))}):type==="card"?jsxRuntimeExports.jsxs("div",{className:"loading-skeleton-card",children:[jsxRuntimeExports.jsx("div",{className:`${baseClass} skeleton-header`,style:{height:"60px",marginBottom:"16px"}}),jsxRuntimeExports.jsx("div",{className:baseClass,style:{width:"80%",height:"16px",marginBottom:"8px"}}),jsxRuntimeExports.jsx("div",{className:baseClass,style:{width:"60%",height:"16px",marginBottom:"8px"}}),jsxRuntimeExports.jsx("div",{className:baseClass,style:{width:"40%",height:"16px"}})]}):type==="button"?jsxRuntimeExports.jsx("div",{className:`${baseClass} skeleton-button`,style:{width,height:"40px"}}):type==="avatar"?jsxRuntimeExports.jsx("div",{className:`${baseClass} skeleton-avatar`,style:{width:"40px",height:"40px",borderRadius:"50%"}}):jsxRuntimeExports.jsx("div",{className:baseClass,style:{width,height}})},"LoadingSkeleton"),SettingsLoadingSkeleton=__name(()=>jsxRuntimeExports.jsxs("div",{className:"settings-skeleton",children:[jsxRuntimeExports.jsx(LoadingSkeleton,{type:"text",lines:1,height:"24px",width:"200px"}),jsxRuntimeExports.jsx("div",{style:{marginTop:"24px"},children:jsxRuntimeExports.jsx(LoadingSkeleton,{type:"card"})}),jsxRuntimeExports.jsx("div",{style:{marginTop:"16px"},children:jsxRuntimeExports.jsx(LoadingSkeleton,{type:"card"})})]}),"SettingsLoadingSkeleton");const AccountTopBar=__name(({onBackClick})=>jsxRuntimeExports.jsx("div",{className:"account-top-bar",children:jsxRuntimeExports.jsxs("div",{className:"top-bar-content",children:[jsxRuntimeExports.jsx("div",{onClick:onBackClick,className:"back-button",children:jsxRuntimeExports.jsx(ArrowBack,{className:"back-icon"})}),jsxRuntimeExports.jsx("div",{className:"top-bar-title",children:"Your account"})]})}),"AccountTopBar"),Account=__name(()=>{const navigate=useNavigate(),[showDeleteConfirm,setShowDeleteConfirm]=reactExports.useState(!1),[showUnbondConfirm,setShowUnbondConfirm]=reactExports.useState(!1),[showEditModal,setShowEditModal]=reactExports.useState(!1),[isLoading,setIsLoading]=reactExports.useState(!0),[userData,setUserData]=reactExports.useState({fullName:"",email:"",dateOfBirth:"",nationality:null,currentCity:null,currentCountry:null}),[showPasswordForm,setShowPasswordForm]=reactExports.useState(!1),[passwordData,setPasswordData]=reactExports.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[passwordErrors,setPasswordErrors]=reactExports.useState({}),[passwordSuccess,setPasswordSuccess]=reactExports.useState(!1);reactExports.useEffect(()=>{__name(async()=>{try{setIsLoading(!0);const[_,currentUser]=await Promise.all([icpUserService.initialize(),Promise.race([icpUserService.getCurrentUser(!0),new Promise(resolve=>setTimeout(()=>resolve(null),5e3))])]);if(currentUser&&currentUser.settings&&currentUser.settings.profileMetadata){const profileData=JSON.parse(currentUser.settings.profileMetadata);setUserData(profileData)}else setUserData({fullName:"",email:"",dateOfBirth:"",nationality:null,currentCity:null,currentCountry:null})}catch{setUserData({fullName:"",email:"",dateOfBirth:"",nationality:null,currentCity:null,currentCountry:null})}finally{setIsLoading(!1)}},"loadUserData")()},[]);const handleBackClick=__name(()=>{navigate("/timeline")},"handleBackClick"),handleEditProfile=__name(()=>{setShowEditModal(!0)},"handleEditProfile"),handleCloseEditModal=__name(async()=>{setShowEditModal(!1);try{const currentUser=await icpUserService.getCurrentUser(!0);if(currentUser&&currentUser.settings&&currentUser.settings.profileMetadata){const profileData=JSON.parse(currentUser.settings.profileMetadata);setUserData(profileData)}}catch{}},"handleCloseEditModal"),handleDeleteAccount=__name(async()=>{if(showDeleteConfirm)try{await icpUserService.deleteAccount(),await icpUserService.logout(),navigate("/")}catch{try{await icpUserService.logout(),navigate("/")}catch{navigate("/")}}else setShowDeleteConfirm(!0),setShowUnbondConfirm(!1)},"handleDeleteAccount"),handleUnbondPartner=__name(()=>{showUnbondConfirm?navigate("/"):(setShowUnbondConfirm(!0),setShowDeleteConfirm(!1))},"handleUnbondPartner"),cancelAction=__name(()=>{setShowDeleteConfirm(!1),setShowUnbondConfirm(!1)},"cancelAction"),handleTogglePasswordForm=__name(()=>{setShowPasswordForm(!showPasswordForm),showPasswordForm||(setPasswordData({currentPassword:"",newPassword:"",confirmPassword:""}),setPasswordErrors({}),setPasswordSuccess(!1))},"handleTogglePasswordForm"),handlePasswordChange=__name(e=>{const{name,value}=e.target;setPasswordData(prev=>({...prev,[name]:value})),passwordErrors[name]&&setPasswordErrors(prev=>({...prev,[name]:""}))},"handlePasswordChange"),validatePasswordForm=__name(()=>{const newErrors={};return passwordData.currentPassword||(newErrors.currentPassword="Current password is required"),passwordData.newPassword?passwordData.newPassword.length<8&&(newErrors.newPassword="Password must be at least 8 characters"):newErrors.newPassword="New password is required",passwordData.newPassword!==passwordData.confirmPassword&&(newErrors.confirmPassword="Passwords do not match"),setPasswordErrors(newErrors),Object.keys(newErrors).length===0},"validatePasswordForm"),handlePasswordSubmit=__name(e=>{e.preventDefault(),validatePasswordForm()&&(setPasswordSuccess(!0),setTimeout(()=>{setShowPasswordForm(!1),setPasswordData({currentPassword:"",newPassword:"",confirmPassword:""}),setPasswordSuccess(!1)},2e3))},"handlePasswordSubmit"),formatDate=__name(dateString=>{if(!dateString)return"Not set";try{return new Date(dateString).toLocaleDateString()}catch{return dateString}},"formatDate");return isLoading?jsxRuntimeExports.jsxs("div",{className:"account-screen",children:[jsxRuntimeExports.jsx(AccountTopBar,{onBackClick:handleBackClick}),jsxRuntimeExports.jsx("div",{className:"account-content",children:jsxRuntimeExports.jsx(SettingsLoadingSkeleton,{})})]}):jsxRuntimeExports.jsxs("div",{className:"account-screen",children:[jsxRuntimeExports.jsx(AccountTopBar,{onBackClick:handleBackClick}),jsxRuntimeExports.jsxs("div",{className:"account-content",children:[jsxRuntimeExports.jsxs("div",{className:"account-section",children:[jsxRuntimeExports.jsx("h2",{className:"section-title",children:"Profile information"}),jsxRuntimeExports.jsxs("div",{className:"profile-info",children:[jsxRuntimeExports.jsx("p",{className:"profile-label",children:"Name"}),jsxRuntimeExports.jsx("p",{className:"profile-value",children:userData.fullName})]}),jsxRuntimeExports.jsxs("div",{className:"profile-info",children:[jsxRuntimeExports.jsx("p",{className:"profile-label",children:"Email"}),jsxRuntimeExports.jsx("p",{className:"profile-value",children:userData.email})]}),userData.dateOfBirth&&jsxRuntimeExports.jsxs("div",{className:"profile-info",children:[jsxRuntimeExports.jsx("p",{className:"profile-label",children:"Date of Birth"}),jsxRuntimeExports.jsx("p",{className:"profile-value",children:formatDate(userData.dateOfBirth)})]}),userData.nationality&&jsxRuntimeExports.jsxs("div",{className:"profile-info",children:[jsxRuntimeExports.jsx("p",{className:"profile-label",children:"Nationality"}),jsxRuntimeExports.jsx("p",{className:"profile-value",children:userData.nationality.label})]}),userData.currentCity&&jsxRuntimeExports.jsxs("div",{className:"profile-info",children:[jsxRuntimeExports.jsx("p",{className:"profile-label",children:"Current City"}),jsxRuntimeExports.jsx("p",{className:"profile-value",children:typeof userData.currentCity=="object"?userData.currentCity.label:userData.currentCity})]}),userData.currentCountry&&jsxRuntimeExports.jsxs("div",{className:"profile-info",children:[jsxRuntimeExports.jsx("p",{className:"profile-label",children:"Current Country"}),jsxRuntimeExports.jsx("p",{className:"profile-value",children:userData.currentCountry.label})]}),jsxRuntimeExports.jsx("button",{className:"edit-button",onClick:handleEditProfile,children:"Edit Profile"})]}),jsxRuntimeExports.jsx("div",{className:"account-divider"}),jsxRuntimeExports.jsxs("div",{className:"account-section",children:[jsxRuntimeExports.jsx("h2",{className:"section-title",children:"Security"}),jsxRuntimeExports.jsx("button",{className:"account-action-button",onClick:handleTogglePasswordForm,children:showPasswordForm?"Cancel":"Change Password"}),showPasswordForm&&jsxRuntimeExports.jsx("form",{className:"password-form",onSubmit:handlePasswordSubmit,children:passwordSuccess?jsxRuntimeExports.jsx("div",{className:"success-message",children:"Password changed successfully!"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"form-field",children:jsxRuntimeExports.jsx(CustomTextField,{label:"Current Password",name:"currentPassword",type:"password",placeholder:"Enter your current password",value:passwordData.currentPassword,onChange:handlePasswordChange,supportingText:passwordErrors.currentPassword||" ",className:passwordErrors.currentPassword?"input-error":""})}),jsxRuntimeExports.jsx("div",{className:"form-field",children:jsxRuntimeExports.jsx(CustomTextField,{label:"New Password",name:"newPassword",type:"password",placeholder:"Enter new password",value:passwordData.newPassword,onChange:handlePasswordChange,supportingText:passwordErrors.newPassword||"Minimum 8 characters",className:passwordErrors.newPassword?"input-error":""})}),jsxRuntimeExports.jsx("div",{className:"form-field",children:jsxRuntimeExports.jsx(CustomTextField,{label:"Confirm New Password",name:"confirmPassword",type:"password",placeholder:"Confirm new password",value:passwordData.confirmPassword,onChange:handlePasswordChange,supportingText:passwordErrors.confirmPassword||" ",className:passwordErrors.confirmPassword?"input-error":""})}),jsxRuntimeExports.jsx("button",{type:"submit",className:"submit-button",children:"Update Password"})]})})]}),jsxRuntimeExports.jsx("div",{className:"account-divider"}),jsxRuntimeExports.jsxs("div",{className:"account-section",children:[jsxRuntimeExports.jsx("h2",{className:"section-title",children:"Partner connection"}),jsxRuntimeExports.jsxs("div",{className:"partner-status",children:[jsxRuntimeExports.jsx("p",{className:"status-label",children:"Status"}),jsxRuntimeExports.jsx("p",{className:"status-value connected",children:"Connected"})]}),jsxRuntimeExports.jsxs("div",{className:"partner-info",children:[jsxRuntimeExports.jsx("p",{className:"profile-label",children:"Partner name"}),jsxRuntimeExports.jsx("p",{className:"profile-value",children:"Jane Doe"})]})]}),jsxRuntimeExports.jsx("div",{className:"account-divider"}),jsxRuntimeExports.jsxs("div",{className:"account-section danger-section",children:[jsxRuntimeExports.jsx("h2",{className:"section-title danger-title",children:"Unbond from partner"}),showUnbondConfirm?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"danger-description",children:"If you do this both of you will lose all access to all your shared data permanently."}),jsxRuntimeExports.jsxs("div",{className:"danger-actions",children:[jsxRuntimeExports.jsx("button",{className:"danger-confirm-button",onClick:handleUnbondPartner,children:"Confirm unbond"}),jsxRuntimeExports.jsx("button",{className:"danger-cancel-button",onClick:cancelAction,children:"Cancel"})]})]}):jsxRuntimeExports.jsx("button",{className:"danger-button",onClick:handleUnbondPartner,children:"Unbond from partner"})]}),jsxRuntimeExports.jsx("div",{className:"account-divider"}),jsxRuntimeExports.jsxs("div",{className:"account-section danger-section",children:[jsxRuntimeExports.jsx("h2",{className:"section-title danger-title",children:"Remove data or delete Account"}),showDeleteConfirm?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"danger-description",children:"I would like to delete my account and all my data."}),jsxRuntimeExports.jsxs("div",{className:"danger-actions",children:[jsxRuntimeExports.jsx("button",{className:"danger-confirm-button",onClick:handleDeleteAccount,children:"Delete account"}),jsxRuntimeExports.jsx("button",{className:"danger-cancel-button",onClick:cancelAction,children:"Cancel"})]})]}):jsxRuntimeExports.jsx("button",{className:"danger-button",onClick:handleDeleteAccount,children:"Delete account"})]})]}),showEditModal&&jsxRuntimeExports.jsx(EditProfileModal,{onClose:handleCloseEditModal})]})},"Account");export{Account};
