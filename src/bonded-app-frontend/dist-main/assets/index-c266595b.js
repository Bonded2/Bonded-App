var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{_ as __vitePreload}from"./icp-sdk-b71c0736.js";import{g as jsxRuntimeExports,R as React,r as reactExports,u as useNavigate,l as useLocation}from"./vendor-e6e658b6.js";import{S as StyleOutlined,M as MenuFrame}from"./MenuFrame-4d6ee874.js";import{L as LocationOn2,C as Chat4}from"./Chat4-c513b43d.js";import{P as Photo1}from"./Photo1-ba09d9c8.js";import{T as TopAppBar}from"./TopAppBar-eb3f5630.js";import{u as useGeoMetadata}from"./useGeoMetadata-3799b13f.js";import{b as aiClassificationService,a as autoAIScanner}from"./autoAIScanner-741976ef.js";import{A as AIClassificationTest}from"./AIClassificationTest-77ebfddf.js";import{ExportTimeline}from"./index-6f43aa5c.js";import{M as MediaScanner}from"./MediaScanner-9c55dca2.js";import"./GeoMetadataProvider-1b35b418.js";import{u as useBondedServices}from"./useBondedServices-4c833e9c.js";import"./ArrowBack-2a597d17.js";import"./EditProfileModal-0f601799.js";import"./icpUserService-71066c08.js";import"./icpCanisterService-30902200.js";import"./index-ed0f0e28.js";import"./CustomTextField-dcd5565c.js";import"./locationService-2b51ac9f.js";import"./timelineService-a34b98cd.js";import"./encryption-3413e488.js";import"./mediaAccess-9b6d075b.js";import"./index-b8afbf61.js";import"./DeleteModal-093423ee.js";const Icn4=__name(({className})=>jsxRuntimeExports.jsxs("svg",{className:`icn-4 ${className}`,fill:"none",height:"27",viewBox:"0 0 27 27",width:"27",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("g",{className:"g",clipPath:"url(#clip0_632_2209)",children:jsxRuntimeExports.jsx("path",{className:"path",d:"M17.8711 13.1285C17.8676 12.8252 17.7542 12.5507 17.5311 12.3327L10.2833 5.52186C9.83742 5.11334 9.14812 5.12124 8.71202 5.56745C8.3035 6.01334 8.3114 6.70264 8.75761 7.13874L15.169 13.1595L8.89731 19.3256C8.4609 19.7442 8.46912 20.4611 8.88775 20.8975C9.30639 21.3339 10.0233 21.3257 10.4597 20.9071L17.5494 13.9319C17.7674 13.7088 17.8746 13.4318 17.8711 13.1285Z",fill:"#FF704D"})}),jsxRuntimeExports.jsx("defs",{className:"defs",children:jsxRuntimeExports.jsx("clipPath",{className:"clip-path",id:"clip0_632_2209",children:jsxRuntimeExports.jsx("rect",{className:"rect",fill:"white",height:"16",transform:"matrix(0.0114624 0.999934 0.999934 -0.0114624 5.09082 5.27441)",width:"16"})})})]}),"Icn4"),Today=__name(({className})=>jsxRuntimeExports.jsx("svg",{className:`today ${className}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{className:"path",d:"M9 16.5C8.3 16.5 7.70833 16.2583 7.225 15.775C6.74167 15.2917 6.5 14.7 6.5 14C6.5 13.3 6.74167 12.7083 7.225 12.225C7.70833 11.7417 8.3 11.5 9 11.5C9.7 11.5 10.2917 11.7417 10.775 12.225C11.2583 12.7083 11.5 13.3 11.5 14C11.5 14.7 11.2583 15.2917 10.775 15.775C10.2917 16.2583 9.7 16.5 9 16.5ZM5 22C4.45 22 3.97917 21.8042 3.5875 21.4125C3.19583 21.0208 3 20.55 3 20V6C3 5.45 3.19583 4.97917 3.5875 4.5875C3.97917 4.19583 4.45 4 5 4H6V2H8V4H16V2H18V4H19C19.55 4 20.0208 4.19583 20.4125 4.5875C20.8042 4.97917 21 5.45 21 6V20C21 20.55 20.8042 21.0208 20.4125 21.4125C20.0208 21.8042 19.55 22 19 22H5ZM5 20H19V10H5V20Z",fill:"#1D1B20"})}),"Today"),Upload1=__name(({color="#1D1B20",className})=>jsxRuntimeExports.jsx("svg",{className:`upload-1 ${className}`,fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{className:"path",d:"M11 16V7.85L8.4 10.45L7 9L12 4L17 9L15.6 10.45L13 7.85V16H11ZM6 20C5.45 20 4.97917 19.8042 4.5875 19.4125C4.19583 19.0208 4 18.55 4 18V15H6V18H18V15H20V18C20 18.55 19.8042 19.0208 19.4125 19.4125C19.0208 19.8042 18.55 20 18 20H6Z",fill:color})}),"Upload1");const EVIDENCE_CATEGORIES={RELATIONSHIP:"relationship",FINANCIAL:"financial",LANGUAGE:"language"},CheckMarkIcon=__name(()=>jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),"CheckMarkIcon"),SourceIcon=__name(({source})=>{switch(source?.toLowerCase()){case"telegram":return jsxRuntimeExports.jsx(StyleOutlined,{className:"source-icon telegram-icon",title:"Telegram"});case"manual":return jsxRuntimeExports.jsx(Today,{className:"source-icon manual-icon",title:"Manual Upload"});case"camera":case"device media":return jsxRuntimeExports.jsx(Upload1,{className:"source-icon device-icon",title:"Device Upload"});default:return null}},"SourceIcon"),UploadStatusIndicator=__name(({status})=>{switch(status){case"pending":case"uploading":return jsxRuntimeExports.jsx("span",{className:"upload-status pending",title:"Uploading",children:"ðŸ•“"});case"completed":return jsxRuntimeExports.jsx("span",{className:"upload-status completed",title:"Completed",children:"âœ…"});case"failed":return jsxRuntimeExports.jsx("span",{className:"upload-status failed",title:"Failed",children:"âŒ"});default:return null}},"UploadStatusIndicator"),TimelineTile=__name(({className,text="10 Photos",text1="Thailand",text2="2 Messages",maskGroup="https://c.animaapp.com/pbEV2e39/img/mask-group-2@2x.png",icon=jsxRuntimeExports.jsx(StyleOutlined,{className:"icon-instance-node"}),maskGroupClassName,source,uploadStatus,date,category=EVIDENCE_CATEGORIES.RELATIONSHIP,aiVerified=!0,evidenceType="media",processTimestamp})=>{maskGroup&&(maskGroup.startsWith("/")||maskGroup.startsWith("./"));const photoCount=text,location=text1,messageCount=text2,imageUrl=maskGroup,messageIcon=icon,formattedTimestamp=processTimestamp||(date?`Processed: ${date}`:""),displayDate=date||new Date().toLocaleDateString();return jsxRuntimeExports.jsxs("div",{className:`timeline-tile ${className||""}`,children:[aiVerified&&jsxRuntimeExports.jsxs("div",{className:"ai-verified-badge",children:[jsxRuntimeExports.jsx(CheckMarkIcon,{})," AI Verified"]}),jsxRuntimeExports.jsxs("div",{className:"status-indicators",children:[source&&jsxRuntimeExports.jsx(SourceIcon,{source}),uploadStatus&&jsxRuntimeExports.jsx(UploadStatusIndicator,{status:uploadStatus})]}),jsxRuntimeExports.jsxs("div",{className:"timeline-tile-image-container","data-timestamp":displayDate,children:[jsxRuntimeExports.jsx("img",{className:`mask-group ${maskGroupClassName||""}`,alt:`Relationship evidence from ${location} on ${displayDate}`,src:imageUrl,loading:"lazy"}),jsxRuntimeExports.jsx("div",{className:"evidence-category",children:category})]}),jsxRuntimeExports.jsxs("div",{className:"timeline-tile-content",children:[jsxRuntimeExports.jsxs("div",{className:"timeline-tile-header",children:[jsxRuntimeExports.jsx("div",{className:`timeline-tile-type ${evidenceType}`,children:evidenceType}),formattedTimestamp&&jsxRuntimeExports.jsx("div",{className:"timeline-tile-timestamp",children:formattedTimestamp})]}),jsxRuntimeExports.jsxs("div",{className:"timeline-tile-info",children:[jsxRuntimeExports.jsxs("div",{className:"timeline-tile-info-item",children:[jsxRuntimeExports.jsx(Photo1,{className:"timeline-tile-info-icon"}),jsxRuntimeExports.jsx("div",{className:"timeline-tile-info-text",children:photoCount})]}),jsxRuntimeExports.jsxs("div",{className:"timeline-tile-info-item",children:[jsxRuntimeExports.jsx(LocationOn2,{className:"timeline-tile-info-icon"}),jsxRuntimeExports.jsx("div",{className:"timeline-tile-info-text",children:location})]}),messageIcon&&jsxRuntimeExports.jsxs("div",{className:"timeline-tile-info-item",children:[React.cloneElement(messageIcon,{className:"timeline-tile-info-icon"}),jsxRuntimeExports.jsx("div",{className:"timeline-tile-info-text",children:messageCount})]})]})]})]})},"TimelineTile");const TimelineTileWrapper=__name(({className,timelineTileMaskGroup="https://c.animaapp.com/pbEV2e39/img/mask-group-2@2x.png",timelineTileText="2 Messages",timelineTileText1="3 Photos",timelineTileText2="Thailand",timelineTileIcon=jsxRuntimeExports.jsx(StyleOutlined,{className:"chat"}),timelineTileMaskGroupClassName,icn4StyleOverrideClassName,onClick,date,source,uploadStatus,evidenceCategory="relationship",evidenceType="media",aiVerified=!0,processTimestamp,blockchainTimestamp})=>{const[isHovered,setIsHovered]=reactExports.useState(!1),[isTouched,setIsTouched]=reactExports.useState(!1),handleClick=__name(()=>{onClick&&onClick(date)},"handleClick"),handleMouseEnter=__name(()=>{setIsHovered(!0)},"handleMouseEnter"),handleMouseLeave=__name(()=>{setIsHovered(!1)},"handleMouseLeave"),handleTouchStart=__name(()=>{setIsTouched(!0),setTimeout(()=>setIsTouched(!1),1e3)},"handleTouchStart"),handleTouchEnd=__name(()=>{setIsTouched(!1)},"handleTouchEnd"),determineEvidenceType=__name(()=>timelineTileText1.includes("Photo")?"photos":timelineTileText.includes("Message")?"messages":timelineTileText.includes("Document")?"document":evidenceType,"determineEvidenceType");return jsxRuntimeExports.jsx("div",{className:`timeline-tile-wrapper ${className||""} ${isHovered||isTouched?"shimmer-effect":""}`,onClick:handleClick,onMouseEnter:handleMouseEnter,onMouseLeave:handleMouseLeave,onTouchStart:handleTouchStart,onTouchEnd:handleTouchEnd,role:"button","aria-label":`View timeline entry for ${date||"timeline item"}`,tabIndex:0,children:jsxRuntimeExports.jsxs("div",{className:"overlap-3",children:[jsxRuntimeExports.jsx(TimelineTile,{className:"timeline-tile-instance",icon:timelineTileIcon,maskGroup:timelineTileMaskGroup,maskGroupClassName:timelineTileMaskGroupClassName,text:timelineTileText1,text1:timelineTileText2,text2:timelineTileText,date,source,uploadStatus,category:evidenceCategory,aiVerified,evidenceType:determineEvidenceType(),processTimestamp}),jsxRuntimeExports.jsx("div",{className:"rectangle-2"}),jsxRuntimeExports.jsx("div",{className:`shimmer-overlay ${isHovered||isTouched?"active":""}`}),icn4StyleOverrideClassName&&jsxRuntimeExports.jsx(Icn4,{className:icn4StyleOverrideClassName})]})})},"TimelineTileWrapper");const AITimelineEntry=__name(({entry,onClick,className="",isAnimated=!1})=>{const[isExpanded,setIsExpanded]=reactExports.useState(!1);if(!entry)return null;const{id,date,files=[],aiProcessed=!1,metadata={},createdAt}=entry,photoCount=files.length,location=metadata.location||"Unknown Location",aiApprovalRate=files.length>0?`${Math.round(files.length/(files.length+(metadata.rejectedCount||0))*100)}% AI Approved`:"No files",thumbnailFile=files.find(file=>file.type&&file.type.startsWith("image/")),thumbnailUrl=thumbnailFile?thumbnailFile.path||URL.createObjectURL(thumbnailFile):"/images/ai-processed-placeholder.jpg",handleClick=__name(()=>{onClick&&onClick(date,entry)},"handleClick"),handleToggleExpanded=__name(e=>{e.stopPropagation(),setIsExpanded(!isExpanded)},"handleToggleExpanded"),formatDate=__name(dateString=>{try{return new Date(dateString).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}catch{return dateString}},"formatDate"),formatTime=__name(timestamp=>{try{return new Date(timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}catch{return""}},"formatTime");return jsxRuntimeExports.jsxs("div",{className:`ai-timeline-entry ${className} ${isAnimated?"animated":""}`,children:[jsxRuntimeExports.jsxs("div",{className:"ai-badge",children:[jsxRuntimeExports.jsx("span",{className:"ai-icon",children:"ðŸ¤–"}),jsxRuntimeExports.jsx("span",{className:"ai-text",children:"AI Processed"})]}),jsxRuntimeExports.jsx(TimelineTileWrapper,{className:"ai-timeline-tile",timelineTileMaskGroup:thumbnailUrl,timelineTileText:aiApprovalRate,timelineTileText1:`${photoCount} Photos`,timelineTileText2:location,timelineTileIcon:jsxRuntimeExports.jsx(Photo1,{className:"ai-photo-icon"}),timelineTileMaskGroupClassName:"ai-timeline-image",onClick:handleClick,date:formatDate(date),source:"auto_ai_scanner",uploadStatus:"completed",evidenceCategory:"relationship",evidenceType:"ai_processed_media",aiVerified:!0,processTimestamp:`AI Processed: ${formatTime(createdAt)}`}),jsxRuntimeExports.jsx("div",{className:"ai-entry-controls",children:jsxRuntimeExports.jsxs("button",{className:"expand-button",onClick:handleToggleExpanded,"aria-label":isExpanded?"Collapse details":"Expand details",children:[jsxRuntimeExports.jsx("span",{className:`expand-icon ${isExpanded?"expanded":""}`,children:"â–¼"}),jsxRuntimeExports.jsx("span",{className:"expand-text",children:isExpanded?"Hide Details":"Show AI Details"})]})}),isExpanded&&jsxRuntimeExports.jsxs("div",{className:"ai-details-panel",children:[jsxRuntimeExports.jsxs("div",{className:"ai-details-header",children:[jsxRuntimeExports.jsx("h4",{children:"AI Classification Results"}),jsxRuntimeExports.jsxs("span",{className:"processing-time",children:["Processed: ",formatTime(createdAt)]})]}),jsxRuntimeExports.jsxs("div",{className:"ai-stats-grid",children:[jsxRuntimeExports.jsxs("div",{className:"ai-stat-item",children:[jsxRuntimeExports.jsx("span",{className:"stat-icon",children:"âœ…"}),jsxRuntimeExports.jsxs("div",{className:"stat-content",children:[jsxRuntimeExports.jsx("span",{className:"stat-value",children:files.length}),jsxRuntimeExports.jsx("span",{className:"stat-label",children:"Approved Files"})]})]}),jsxRuntimeExports.jsxs("div",{className:"ai-stat-item",children:[jsxRuntimeExports.jsx("span",{className:"stat-icon",children:"âŒ"}),jsxRuntimeExports.jsxs("div",{className:"stat-content",children:[jsxRuntimeExports.jsx("span",{className:"stat-value",children:metadata.rejectedCount||0}),jsxRuntimeExports.jsx("span",{className:"stat-label",children:"Filtered Files"})]})]}),jsxRuntimeExports.jsxs("div",{className:"ai-stat-item",children:[jsxRuntimeExports.jsx("span",{className:"stat-icon",children:"ðŸŽ¯"}),jsxRuntimeExports.jsxs("div",{className:"stat-content",children:[jsxRuntimeExports.jsxs("span",{className:"stat-value",children:[Math.round(files.length/(files.length+(metadata.rejectedCount||0))*100),"%"]}),jsxRuntimeExports.jsx("span",{className:"stat-label",children:"Approval Rate"})]})]}),jsxRuntimeExports.jsxs("div",{className:"ai-stat-item",children:[jsxRuntimeExports.jsx("span",{className:"stat-icon",children:"âš¡"}),jsxRuntimeExports.jsxs("div",{className:"stat-content",children:[jsxRuntimeExports.jsx("span",{className:"stat-value",children:metadata.fileCount||files.length}),jsxRuntimeExports.jsx("span",{className:"stat-label",children:"Total Scanned"})]})]})]}),files.length>0&&jsxRuntimeExports.jsxs("div",{className:"ai-files-preview",children:[jsxRuntimeExports.jsxs("h5",{children:["Approved Files (",files.length,")"]}),jsxRuntimeExports.jsxs("div",{className:"files-grid",children:[files.slice(0,6).map((file,index)=>jsxRuntimeExports.jsxs("div",{className:"file-preview",children:[file.type&&file.type.startsWith("image/")?jsxRuntimeExports.jsxs("div",{className:"file-thumbnail",children:[jsxRuntimeExports.jsx("img",{src:file.path||URL.createObjectURL(file),alt:file.name,onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),jsxRuntimeExports.jsx("div",{className:"file-placeholder",style:{display:"none"},children:"ðŸ“·"})]}):jsxRuntimeExports.jsx("div",{className:"file-placeholder",children:"ðŸ“„"}),jsxRuntimeExports.jsx("span",{className:"file-name",title:file.name,children:file.name?file.name.substring(0,12)+"...":`File ${index+1}`})]},index)),files.length>6&&jsxRuntimeExports.jsxs("div",{className:"file-preview more-files",children:[jsxRuntimeExports.jsxs("div",{className:"file-placeholder",children:["+",files.length-6]}),jsxRuntimeExports.jsx("span",{className:"file-name",children:"More files"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"ai-metadata",children:[jsxRuntimeExports.jsxs("div",{className:"metadata-row",children:[jsxRuntimeExports.jsx("span",{className:"metadata-label",children:"Source:"}),jsxRuntimeExports.jsx("span",{className:"metadata-value",children:"Automatic Gallery Scan"})]}),jsxRuntimeExports.jsxs("div",{className:"metadata-row",children:[jsxRuntimeExports.jsx("span",{className:"metadata-label",children:"Scan ID:"}),jsxRuntimeExports.jsx("span",{className:"metadata-value",children:id})]}),jsxRuntimeExports.jsxs("div",{className:"metadata-row",children:[jsxRuntimeExports.jsx("span",{className:"metadata-label",children:"Date Range:"}),jsxRuntimeExports.jsx("span",{className:"metadata-value",children:formatDate(date)})]}),metadata.scanTimestamp&&jsxRuntimeExports.jsxs("div",{className:"metadata-row",children:[jsxRuntimeExports.jsx("span",{className:"metadata-label",children:"Scan Time:"}),jsxRuntimeExports.jsx("span",{className:"metadata-value",children:formatTime(metadata.scanTimestamp)})]})]})]})]})},"AITimelineEntry");const getFileTypeCategory=__name(fileNameOrType=>{const name=typeof fileNameOrType=="string"?fileNameOrType:fileNameOrType.name,type=typeof fileNameOrType=="string"?"":fileNameOrType.type,extension=name.split(".").pop().toLowerCase();return type.startsWith("image/")||["jpg","jpeg","png","gif","bmp","webp","heic"].includes(extension)?"image":type.startsWith("application/pdf")||["pdf","doc","docx","txt","xls","xlsx","ppt","pptx"].includes(extension)?"document":type.startsWith("video/")||["mov","mp4","avi","mkv"].includes(extension)?"video":"other"},"getFileTypeCategory"),FileIcon=__name(({file})=>getFileTypeCategory(file)==="image"?jsxRuntimeExports.jsx(Photo1,{className:"file-item-icon image-icon"}):jsxRuntimeExports.jsx("span",{className:"file-item-icon generic-icon",children:"ðŸ“„"}),"FileIcon"),getExclusionReason=__name((file,captureSettings,fileTypeOverrides,aiClassificationResult=null)=>{const category=getFileTypeCategory(file),fileExt=file.name.split(".").pop().toLowerCase();if(fileTypeOverrides&&fileTypeOverrides[fileExt]===!1)return`Manually excluded file type: .${fileExt}`;if(aiClassificationResult&&category==="image"){const exclusion=aiClassificationService.shouldExcludeContent(aiClassificationResult,"image");if(exclusion.exclude)return`AI Filter: ${exclusion.reason}`}if(captureSettings){if(category==="image"&&captureSettings.photos==="none")return"Image capture is set to 'none'.";if(category==="document"&&captureSettings.documents==="none")return"Document capture is set to 'none'.";if(category==="video"&&captureSettings.videos==="none")return"Video capture is set to 'none'."}return null},"getExclusionReason"),UploadModal=__name(({onClose,onFilesUpload,captureSettings,fileTypeOverrides})=>{const fileInputRef=reactExports.useRef(null),[selectedFiles,setSelectedFiles]=reactExports.useState([]),[checkedFiles,setCheckedFiles]=reactExports.useState({}),[currentFilter,setCurrentFilter]=reactExports.useState("all"),[hoveredExclusion,setHoveredExclusion]=reactExports.useState(null),[isPreparingUpload,setIsPreparingUpload]=reactExports.useState(!1),[aiClassificationResults,setAiClassificationResults]=reactExports.useState({}),[isClassifying,setIsClassifying]=reactExports.useState(!1),[showAIDemo,setShowAIDemo]=reactExports.useState(!1),{getMetadataForFile,refreshMetadata}=useGeoMetadata();reactExports.useEffect(()=>{aiClassificationService.initialize().catch(()=>{})},[]);const handleSelectFilesClick=__name(()=>{fileInputRef.current.click()},"handleSelectFilesClick"),handleFileInputChange=__name(async e=>{const uniqueNewFiles=Array.from(e.target.files).filter(nf=>!selectedFiles.some(sf=>sf.name===nf.name&&sf.size===nf.size));setSelectedFiles(prev=>[...prev,...uniqueNewFiles]);const newChecked={...checkedFiles};uniqueNewFiles.forEach(file=>newChecked[file.name]=!0),setCheckedFiles(newChecked),fileInputRef.current&&(fileInputRef.current.value=""),await classifyNewFiles(uniqueNewFiles)},"handleFileInputChange"),classifyNewFiles=__name(async files=>{const imageFiles=files.filter(file=>getFileTypeCategory(file)==="image");if(imageFiles.length!==0){setIsClassifying(!0);try{const classificationPromises=imageFiles.map(async file=>{try{const result=await aiClassificationService.classifyImage(file);return{fileName:file.name,result}}catch(error){return{fileName:file.name,error:error.message}}}),results=await Promise.all(classificationPromises),newResults={...aiClassificationResults};results.forEach(({fileName,result,error})=>{newResults[fileName]=error?{error}:result}),setAiClassificationResults(newResults)}catch{}finally{setIsClassifying(!1)}}},"classifyNewFiles"),handleCheckboxChange=__name(fileName=>{setCheckedFiles(prev=>({...prev,[fileName]:!prev[fileName]}))},"handleCheckboxChange"),handleUploadChecked=__name(async()=>{try{setIsPreparingUpload(!0),await refreshMetadata();const filesToUpload=selectedFiles.filter(file=>checkedFiles[file.name]),finalFilesToUpload=filesToUpload.filter(file=>{const aiResult=aiClassificationResults[file.name];return!getExclusionReason(file,captureSettings,fileTypeOverrides,aiResult)});if(finalFilesToUpload.length!==filesToUpload.length){const excludedCount=filesToUpload.length-finalFilesToUpload.length;if(!confirm(`${excludedCount} checked file(s) will be excluded by current filter settings. Proceed with upload?`)){setIsPreparingUpload(!1);return}}if(finalFilesToUpload.length>0){const filesWithMetadata=await Promise.all(finalFilesToUpload.map(async file=>await getMetadataForFile(file)));onFilesUpload&&onFilesUpload(filesWithMetadata),onClose()}else alert("No files selected for upload or all selected files are excluded by filters.")}catch{alert("There was an error preparing your files for upload.")}finally{setIsPreparingUpload(!1)}},"handleUploadChecked"),filteredFiles=selectedFiles.filter(file=>{if(currentFilter==="all")return!0;const category=getFileTypeCategory(file);return currentFilter==="images"?category==="image":currentFilter==="docs"?category==="document":!0}),toggleSelectAll=__name(()=>{const allVisibleCurrentlyChecked=filteredFiles.length>0&&filteredFiles.every(file=>checkedFiles[file.name]),newCheckedState={...checkedFiles};filteredFiles.forEach(file=>{newCheckedState[file.name]=!allVisibleCurrentlyChecked}),setCheckedFiles(newCheckedState)},"toggleSelectAll"),countCheckedFiles=__name(()=>Object.values(checkedFiles).filter(Boolean).length,"countCheckedFiles");return jsxRuntimeExports.jsxs("div",{className:"upload-modal-overlay",children:[jsxRuntimeExports.jsx("div",{className:"upload-modal-container",children:jsxRuntimeExports.jsxs("div",{className:"upload-modal-content",children:[jsxRuntimeExports.jsxs("div",{className:"upload-modal-header",children:[jsxRuntimeExports.jsx("div",{className:"trailing-icon",children:jsxRuntimeExports.jsx("div",{className:"close-icon",onClick:onClose,"aria-label":"Close upload modal",children:jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z",fill:"#FFFFFF"})})})}),jsxRuntimeExports.jsx("div",{className:"upload-modal-title",children:jsxRuntimeExports.jsx("h2",{children:"Upload Media"})})]}),jsxRuntimeExports.jsx("div",{className:"upload-modal-body",children:selectedFiles.length===0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("p",{className:"upload-text",children:"Select images, documents, or other files from your device."}),jsxRuntimeExports.jsx("div",{className:"upload-icon-container",children:jsxRuntimeExports.jsx(Upload1,{className:"main-upload-icon"})}),jsxRuntimeExports.jsx("button",{className:"select-files-btn primary",onClick:handleSelectFilesClick,children:"Browse Files"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"file-filters",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>setCurrentFilter("all"),className:currentFilter==="all"?"active":"",children:["All (",selectedFiles.length,")"]}),jsxRuntimeExports.jsx("button",{onClick:()=>setCurrentFilter("images"),className:currentFilter==="images"?"active":"",children:"Images"}),jsxRuntimeExports.jsx("button",{onClick:()=>setCurrentFilter("docs"),className:currentFilter==="docs"?"active":"",children:"Documents"})]}),jsxRuntimeExports.jsx("div",{className:"file-list-container",children:filteredFiles.length>0?jsxRuntimeExports.jsxs("ul",{className:"file-list",children:[jsxRuntimeExports.jsxs("li",{className:"file-list-header",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",onChange:toggleSelectAll,checked:filteredFiles.length>0&&filteredFiles.every(file=>!!checkedFiles[file.name]),"aria-label":"Select all visible files"}),jsxRuntimeExports.jsxs("span",{children:["Select All Visible (",filteredFiles.filter(f=>!!checkedFiles[f.name]).length," / ",filteredFiles.length,")"]})]}),filteredFiles.map(file=>{const aiResult=aiClassificationResults[file.name],exclusionReason=getExclusionReason(file,captureSettings,fileTypeOverrides,aiResult),isExcluded=!!exclusionReason,isImage=getFileTypeCategory(file)==="image",isCurrentlyClassifying=isImage&&!aiResult&&isClassifying;return jsxRuntimeExports.jsxs("li",{className:`file-item ${isExcluded?"excluded":""} ${checkedFiles[file.name]&&isExcluded?"checked-excluded":""}`,onMouseEnter:()=>isExcluded&&setHoveredExclusion(file.name),onMouseLeave:()=>isExcluded&&setHoveredExclusion(null),children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:checkedFiles[file.name]||!1,onChange:()=>handleCheckboxChange(file.name),"aria-labelledby":`fileName-${file.name}`,disabled:isExcluded&&!checkedFiles[file.name]}),jsxRuntimeExports.jsx(FileIcon,{file}),jsxRuntimeExports.jsxs("div",{className:"file-details",children:[jsxRuntimeExports.jsx("span",{id:`fileName-${file.name}`,className:"file-name",title:file.name,children:file.name}),jsxRuntimeExports.jsxs("span",{className:"file-meta",children:[(file.size/1024).toFixed(1)," KB â€¢ ",new Date(file.lastModified).toLocaleDateString(),isExcluded&&jsxRuntimeExports.jsx("span",{className:"exclusion-indicator",children:" â„¹ï¸"}),isImage&&jsxRuntimeExports.jsx("span",{className:"ai-status",children:isCurrentlyClassifying?jsxRuntimeExports.jsx("span",{className:"ai-processing",children:" ðŸ”„ AI Analyzing..."}):aiResult?.error?jsxRuntimeExports.jsx("span",{className:"ai-error",children:" âš ï¸ AI Error"}):aiResult?.success?aiResult.data.content_appropriate?jsxRuntimeExports.jsx("span",{className:"ai-approved",children:" âœ… AI Approved"}):jsxRuntimeExports.jsx("span",{className:"ai-rejected",children:" âŒ AI Rejected"}):null})]})]}),hoveredExclusion===file.name&&isExcluded&&jsxRuntimeExports.jsx("div",{className:"exclusion-tooltip",children:exclusionReason})]},`${file.name}-${file.lastModified}`)})]}):jsxRuntimeExports.jsx("p",{className:"no-files-text",children:"No files match the current filter or no files selected."})}),jsxRuntimeExports.jsxs("div",{className:"upload-actions",children:[jsxRuntimeExports.jsx("button",{className:"select-files-btn secondary",onClick:handleSelectFilesClick,children:"Add More Files"}),jsxRuntimeExports.jsx("button",{className:"upload-checked-btn primary",onClick:handleUploadChecked,disabled:countCheckedFiles()===0||isPreparingUpload||isClassifying,children:isPreparingUpload?jsxRuntimeExports.jsx("span",{children:"Preparing Files..."}):isClassifying?jsxRuntimeExports.jsx("span",{children:"AI Processing..."}):jsxRuntimeExports.jsxs("span",{children:["Upload ",countCheckedFiles()," Selected"]})})]}),(isClassifying||Object.keys(aiClassificationResults).length>0)&&jsxRuntimeExports.jsxs("div",{className:"ai-classification-status",children:[jsxRuntimeExports.jsx("h4",{children:"AI Content Filtering"}),jsxRuntimeExports.jsx("p",{children:isClassifying?"Analyzing images for content appropriateness...":"Image analysis complete. Inappropriate content will be automatically excluded."}),jsxRuntimeExports.jsx("button",{className:"ai-test-button",onClick:()=>setShowAIDemo(!0),children:"Test Content Filter"})]})]})}),jsxRuntimeExports.jsx("input",{type:"file",ref:fileInputRef,style:{display:"none"},onChange:handleFileInputChange,multiple:!0,accept:"*/*"})]})}),showAIDemo&&jsxRuntimeExports.jsx(AIClassificationTest,{onClose:()=>setShowAIDemo(!1)})]})},"UploadModal");const ExportModal=__name(({onClose})=>{const navigate=useNavigate(),[showExportTimeline,setShowExportTimeline]=reactExports.useState(!1),handleExportTimeline=__name(()=>{setShowExportTimeline(!0)},"handleExportTimeline"),handleExportCountrySpecific=__name(()=>{onClose&&onClose()},"handleExportCountrySpecific"),handleExportAllAndLeave=__name(()=>{onClose&&onClose(),navigate("/export-all-data")},"handleExportAllAndLeave"),handleCloseExportTimeline=__name(()=>{setShowExportTimeline(!1)},"handleCloseExportTimeline");return showExportTimeline?jsxRuntimeExports.jsx("div",{className:"export-modal-overlay",children:jsxRuntimeExports.jsx(ExportTimeline,{onClose:handleCloseExportTimeline})}):jsxRuntimeExports.jsx("div",{className:"export-modal-overlay",children:jsxRuntimeExports.jsx("div",{className:"export-modal-container",children:jsxRuntimeExports.jsxs("div",{className:"export-modal-content",children:[jsxRuntimeExports.jsxs("div",{className:"export-modal-header",children:[jsxRuntimeExports.jsx("div",{className:"trailing-icon",children:jsxRuntimeExports.jsx("div",{className:"close-icon",onClick:onClose,children:jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z",fill:"white"})})})}),jsxRuntimeExports.jsx("div",{className:"export-modal-title",children:jsxRuntimeExports.jsx("h2",{children:"Export your data"})})]}),jsxRuntimeExports.jsxs("div",{className:"export-modal-body",children:[jsxRuntimeExports.jsx("p",{className:"export-text",children:"Choose from the following options:"}),jsxRuntimeExports.jsxs("div",{className:"export-options",children:[jsxRuntimeExports.jsxs("div",{className:"export-row",onClick:handleExportTimeline,children:[jsxRuntimeExports.jsx("div",{className:"export-icon",children:jsxRuntimeExports.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M9 4H15V6H9V4Z",fill:"#FF704D"}),jsxRuntimeExports.jsx("path",{d:"M16 2H8C7.45 2 7 2.45 7 3V5C7 5.55 7.45 6 8 6H9V7C9 8.66 10.34 10 12 10C13.66 10 15 8.66 15 7V6H16C16.55 6 17 5.55 17 5V3C17 2.45 16.55 2 16 2Z",fill:"#FF704D"}),jsxRuntimeExports.jsx("path",{d:"M20 18L14 18V16L10 16V18L4 18L4 20L10 20V22L14 22V20L20 20V18Z",fill:"#FF704D"}),jsxRuntimeExports.jsx("path",{d:"M15 8H13V14H15V8Z",fill:"#FF704D"}),jsxRuntimeExports.jsx("path",{d:"M11 8H9V14H11V8Z",fill:"#FF704D"})]})}),jsxRuntimeExports.jsx("div",{className:"export-option-text",children:"Export timeline"})]}),jsxRuntimeExports.jsxs("div",{className:"export-row",onClick:handleExportCountrySpecific,children:[jsxRuntimeExports.jsx("div",{className:"export-icon",children:jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM13 17H8C7.45 17 7 16.55 7 16C7 15.45 7.45 15 8 15H13C13.55 15 14 15.45 14 16C14 16.55 13.55 17 13 17ZM16 13H8C7.45 13 7 12.55 7 12C7 11.45 7.45 11 8 11H16C16.55 11 17 11.45 17 12C17 12.55 16.55 13 16 13ZM16 9H8C7.45 9 7 8.55 7 8C7 7.45 7.45 7 8 7H16C16.55 7 17 7.45 17 8C17 8.55 16.55 9 16 9Z",fill:"#FF704D"})})}),jsxRuntimeExports.jsx("div",{className:"export-option-text",children:"Export as a country specific requirement"})]}),jsxRuntimeExports.jsxs("div",{className:"export-row",onClick:handleExportAllAndLeave,children:[jsxRuntimeExports.jsx("div",{className:"export-icon",children:jsxRuntimeExports.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M5 5H12V3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H12V19H5V5Z",fill:"#FF704D"}),jsxRuntimeExports.jsx("path",{d:"M21 12L17 8V11H9V13H17V16L21 12Z",fill:"#FF704D"})]})}),jsxRuntimeExports.jsx("div",{className:"export-option-text",children:"Leave Bonded and export all data"})]})]})]})]})})})},"ExportModal");const TIMELINE_DATA_KEY="bonded_timeline_data",AI_TIMELINE_DATA_KEY="aiProcessedTimeline",TimelineCreated=__name(()=>{const navigate=useNavigate(),location=useLocation(),[isMenuOpen,setIsMenuOpen]=reactExports.useState(!1),[isUploadModalOpen,setIsUploadModalOpen]=reactExports.useState(!1),[isExportModalOpen,setIsExportModalOpen]=reactExports.useState(!1),[isMediaScannerOpen,setIsMediaScannerOpen]=reactExports.useState(!1),[animatedItems,setAnimatedItems]=reactExports.useState([]),[showImportSuccess,setShowImportSuccess]=reactExports.useState(!1),[importedMediaInfo,setImportedMediaInfo]=reactExports.useState(null),[loading,setLoading]=reactExports.useState(!0),[error,setError]=reactExports.useState(null),[processingEvidence,setProcessingEvidence]=reactExports.useState(!1),[uploadProgress,setUploadProgress]=reactExports.useState(null),timelineRef=reactExports.useRef(null),{isInitialized,isLoading:servicesLoading,timeline:bondedTimeline,statistics,refreshTimeline,processEvidence,exportToPDF,isUploadDue,error:servicesError,canisterIntegration,encryptionService}=useBondedServices(),[timelineData,setTimelineData]=reactExports.useState([]),[aiTimelineData,setAiTimelineData]=reactExports.useState([]),[combinedTimelineData,setCombinedTimelineData]=reactExports.useState([]),[evidenceStats,setEvidenceStats]=reactExports.useState({totalEntries:0,photoEntries:0,messageEntries:0,documentEntries:0,lastUpdate:null}),processEvidenceWithEncryption=reactExports.useCallback(async evidence=>{if(!encryptionService||!canisterIntegration)return{success:!1,reason:"Services not initialized"};try{setProcessingEvidence(!0),setUploadProgress({stage:"encrypting",progress:25});const encryptedData=await encryptionService.encryptEvidence(evidence);setUploadProgress({stage:"hashing",progress:50});const evidenceHash=await encryptionService.computeHash(evidence);setUploadProgress({stage:"uploading",progress:75});let relationshipId="mock-relationship-id";try{const{default:icpCanisterService}=await __vitePreload(()=>import("./icpCanisterService-30902200.js"),["assets/icpCanisterService-30902200.js","assets/icp-sdk-b71c0736.js","assets/vendor-e6e658b6.js","assets/index-ed0f0e28.js"]);if(icpCanisterService.isAuthenticated){const userProfile=await icpCanisterService.getUserProfile();userProfile.relationships&&userProfile.relationships.length>0&&(relationshipId=userProfile.relationships[0])}}catch{}const uploadResult=await canisterIntegration.uploadEvidence(relationshipId,encryptedData,{timestamp:Date.now(),contentType:evidence.type,hash:evidenceHash,category:evidence.category||"relationship"});return setUploadProgress({stage:"completed",progress:100}),uploadResult}catch(error2){throw error2}finally{setProcessingEvidence(!1),setTimeout(()=>setUploadProgress(null),2e3)}},[encryptionService,canisterIntegration]),loadEncryptedTimeline=reactExports.useCallback(async()=>{if(!(!canisterIntegration||!encryptionService))try{setLoading(!0),setError(null);const encryptedTimeline=await canisterIntegration.fetchTimeline({page:0,limit:50});if(!encryptedTimeline||!encryptedTimeline.entries){setTimelineData([]);return}const decryptedEntries=[];for(const entry of encryptedTimeline.entries)try{const decryptedData=await encryptionService.decryptEvidence(entry.encryptedData);decryptedEntries.push({id:entry.id,...decryptedData,timestamp:entry.metadata?.timestamp||Date.now(),uploadStatus:"completed",source:"encrypted_vault",blockchainTimestamp:entry.created_at,hash:entry.metadata?.hash,category:entry.metadata?.category||"relationship"})}catch{decryptedEntries.push({id:entry.id,date:new Date(entry.created_at).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),photos:0,messages:0,location:"Encrypted Entry",uploadStatus:"decryption_failed",source:"encrypted_vault",error:"Failed to decrypt"})}decryptedEntries.sort((a,b)=>(b.timestamp||0)-(a.timestamp||0)),setTimelineData(decryptedEntries),setEvidenceStats({totalEntries:decryptedEntries.length,photoEntries:decryptedEntries.filter(e=>e.photos>0).length,messageEntries:decryptedEntries.filter(e=>e.messages>0).length,documentEntries:decryptedEntries.filter(e=>e.category==="document").length,lastUpdate:new Date().toISOString()})}catch(error2){setError(`Failed to load timeline: ${error2.message}`);try{const localData=await(await __vitePreload(()=>import("./realCanisterStorage-e1d3a70a.js"),["assets/realCanisterStorage-e1d3a70a.js","assets/canisterIntegration-a5c53e9e.js","assets/vendor-e6e658b6.js","assets/icp-sdk-b71c0736.js","assets/index-ed0f0e28.js","assets/icpNetworkHelper-2c245b46.js","assets/emailService-11bba984.js"])).default.getItem(TIMELINE_DATA_KEY);if(localData){const parsedData=JSON.parse(localData);Array.isArray(parsedData)&&setTimelineData(parsedData)}}catch{}}finally{setLoading(!1)}},[canisterIntegration,encryptionService]),loadAITimelineData=reactExports.useCallback(async()=>{try{let allAIData=[];try{const{timelineService}=await __vitePreload(()=>import("./timelineService-a34b98cd.js"),["assets/timelineService-a34b98cd.js","assets/icp-sdk-b71c0736.js","assets/vendor-e6e658b6.js","assets/encryption-3413e488.js","assets/icpCanisterService-30902200.js","assets/index-ed0f0e28.js"]),clusteredTimeline=await timelineService.getClusteredTimeline();clusteredTimeline&&typeof clusteredTimeline=="object"&&Object.values(clusteredTimeline).forEach(cluster=>{cluster&&cluster.entries&&Array.isArray(cluster.entries)&&allAIData.push(...cluster.entries)})}catch{}try{const savedAIData=await(await __vitePreload(()=>import("./realCanisterStorage-e1d3a70a.js"),["assets/realCanisterStorage-e1d3a70a.js","assets/canisterIntegration-a5c53e9e.js","assets/vendor-e6e658b6.js","assets/icp-sdk-b71c0736.js","assets/index-ed0f0e28.js","assets/icpNetworkHelper-2c245b46.js","assets/emailService-11bba984.js"])).default.getItem(AI_TIMELINE_DATA_KEY);if(savedAIData){const parsedAIData=JSON.parse(savedAIData);Array.isArray(parsedAIData)&&parsedAIData.forEach(item=>{allAIData.find(existing=>existing.id===item.id)||allAIData.push(item)})}}catch{}allAIData.sort((a,b)=>(b.timestamp||0)-(a.timestamp||0)),setAiTimelineData(allAIData)}catch(error2){console.error("Failed to load AI timeline data:",error2),setAiTimelineData([])}},[]),combineTimelineData=reactExports.useCallback(()=>{const combined=[];timelineData.forEach(item=>{combined.push({...item,type:"encrypted_evidence",sortTimestamp:item.timestamp||Date.now()})}),aiTimelineData.forEach(item=>{combined.push({...item,type:"ai_processed",sortTimestamp:new Date(item.createdAt).getTime()})}),Array.isArray(bondedTimeline)&&bondedTimeline.forEach(item=>{combined.push({...item,type:"bonded_evidence",sortTimestamp:item.timestamp||Date.now()})}),combined.sort((a,b)=>b.sortTimestamp-a.sortTimestamp),setCombinedTimelineData(combined)},[timelineData,aiTimelineData,bondedTimeline]);reactExports.useEffect(()=>{isInitialized&&!servicesLoading&&(loadEncryptedTimeline(),loadAITimelineData())},[isInitialized,servicesLoading,loadEncryptedTimeline,loadAITimelineData]),reactExports.useEffect(()=>{combineTimelineData()},[combineTimelineData]),reactExports.useEffect(()=>{const aiScannerObserver=__name((event,data)=>{event==="timelineUpdated"&&(loadAITimelineData(),isInitialized&&loadEncryptedTimeline(),refreshTimeline&&refreshTimeline())},"aiScannerObserver");return autoAIScanner.addObserver(aiScannerObserver),()=>{autoAIScanner.removeObserver(aiScannerObserver)}},[loadAITimelineData,loadEncryptedTimeline,isInitialized,refreshTimeline]);const handleMediaSelected=__name(async(selectedFiles,groupedByDate)=>{try{setProcessingEvidence(!0),setIsMediaScannerOpen(!1);const{aiEvidenceFilter}=await __vitePreload(()=>import("./index-556a343f.js"),["assets/index-556a343f.js","assets/icp-sdk-b71c0736.js","assets/vendor-e6e658b6.js","assets/evidenceFilter-6e1ec898.js","assets/textClassification-848edeeb.js","assets/encryption-3413e488.js","assets/canisterIntegration-a5c53e9e.js","assets/index-ed0f0e28.js","assets/icpNetworkHelper-2c245b46.js","assets/emailService-11bba984.js","assets/mediaAccess-9b6d075b.js","assets/timelineService-a34b98cd.js","assets/icpCanisterService-30902200.js"]),{timelineService}=await __vitePreload(()=>import("./timelineService-a34b98cd.js"),["assets/timelineService-a34b98cd.js","assets/icp-sdk-b71c0736.js","assets/vendor-e6e658b6.js","assets/encryption-3413e488.js","assets/icpCanisterService-30902200.js","assets/index-ed0f0e28.js"]);let processedCount=0,approvedCount=0,rejectedCount=0;for(const fileData of selectedFiles)try{processedCount++;const imageElement=await createImageFromFile(fileData.file),filterResult=await aiEvidenceFilter.filterImage(imageElement,fileData.metadata);if(filterResult.approved){approvedCount++;const timelineEntry={id:`timeline_scan_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:filterResult.details.ocrExtraction?.text?"photo_with_text":"photo",content:{file:fileData.file,filename:fileData.file.name,fileType:fileData.file.type,fileSize:fileData.file.size,extractedText:filterResult.details.ocrExtraction?.text||null},metadata:{...fileData.metadata,source:"timeline_scan",aiProcessed:!0,aiResult:filterResult,nsfwFiltered:!0,processingTime:filterResult.processing_time||0},timestamp:new Date(fileData.timestamp||fileData.file.lastModified).toISOString(),uploadStatus:"pending"};await timelineService.addTimelineEntry(timelineEntry)}else rejectedCount++}catch(error2){rejectedCount++,console.error(`Error processing file ${fileData.file.name}:`,error2)}setImportedMediaInfo({mediaCount:approvedCount,processedCount,rejectedCount,dateRange:formatDateRangeForDisplay(groupedByDate)}),setShowImportSuccess(!0),await loadEncryptedTimeline(),await loadAITimelineData(),refreshTimeline&&await refreshTimeline(),setTimeout(()=>setShowImportSuccess(!1),5e3)}catch(error2){setError(`Failed to process media: ${error2.message}`)}finally{setProcessingEvidence(!1)}},"handleMediaSelected"),createImageFromFile=__name(file=>new Promise((resolve,reject)=>{const img=new Image;img.onload=()=>{URL.revokeObjectURL(img.src),resolve(img)},img.onerror=()=>{URL.revokeObjectURL(img.src),reject(new Error("Failed to load image"))},img.src=URL.createObjectURL(file)}),"createImageFromFile"),handleProcessEvidenceClick=__name(async()=>{try{setProcessingEvidence(!0),setError(null);const result=await processEvidence();result.success?(result.evidence&&await processEvidenceWithEncryption(result.evidence),setShowImportSuccess(!0),setImportedMediaInfo({count:(result.evidence?.photo?1:0)+(result.evidence?.messages?.length||0),type:result.evidence?.photo?"photo and messages":"messages"}),await loadEncryptedTimeline(),setTimeout(()=>setShowImportSuccess(!1),3e3)):setError(`Evidence processing failed: ${result.errors?.join(", ")||"Unknown error"}`)}catch(err){setError(`Failed to process evidence: ${err.message}`)}finally{setProcessingEvidence(!1)}},"handleProcessEvidenceClick"),handleRefreshTimeline=__name(async()=>{try{setLoading(!0),setError(null),await Promise.all([loadEncryptedTimeline(),refreshTimeline&&refreshTimeline(!0),loadAITimelineData()])}catch(err){setError(`Failed to refresh timeline: ${err.message}`)}finally{setLoading(!1)}},"handleRefreshTimeline");reactExports.useEffect(()=>{servicesError&&setError(`Service error: ${servicesError}`)},[servicesError]),reactExports.useEffect(()=>{if(location.state?.fromMediaScanner||location.state?.fromMediaImport){const{mediaCount,dateRange}=location.state;setImportedMediaInfo({mediaCount,dateRange}),setShowImportSuccess(!0),isInitialized&&loadEncryptedTimeline(),timelineRef.current&&timelineRef.current.scrollTo(0,0);const timer=setTimeout(()=>{setShowImportSuccess(!1)},5e3);return window.history.replaceState({},document.title),()=>clearTimeout(timer)}},[location,isInitialized,loadEncryptedTimeline]),reactExports.useEffect(()=>{if(!combinedTimelineData.length)return;const observer=new IntersectionObserver(entries=>{entries.forEach(entry=>{entry.isIntersecting&&setAnimatedItems(prev=>[...prev,entry.target.dataset.id])})},{threshold:.3}),elements=document.querySelectorAll(".timeline-item");return elements.forEach(element=>observer.observe(element)),()=>elements.forEach(element=>observer.unobserve(element))},[combinedTimelineData]),reactExports.useEffect(()=>{if(!combinedTimelineData.length)return;const timer=setTimeout(()=>{const itemsToAnimate=Math.min(combinedTimelineData.length,3),itemIds=combinedTimelineData.slice(0,itemsToAnimate).map(item=>item.id);setAnimatedItems(itemIds)},500);return()=>clearTimeout(timer)},[combinedTimelineData]);const formatDateForDisplay=__name(date=>{try{(!(date instanceof Date)||isNaN(date.getTime()))&&(date=new Date);const options={day:"numeric",month:"short",year:"numeric"};return date.toLocaleDateString("en-GB",options)}catch{return new Date().toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}},"formatDateForDisplay"),determineEvidenceCategory=__name(item=>item.messages>0&&item.photos>0?"relationship":item.location?.toLowerCase().includes("bank")||item.location?.toLowerCase().includes("financial")?"financial":item.location?.toLowerCase().includes("travel")||item.location?.toLowerCase().includes("airport")?"travel":item.photos>0?"photo":item.messages>0?"communication":"general","determineEvidenceCategory"),determineEvidenceType=__name(item=>item.type==="ai_processed"?"AI Processed":item.type==="encrypted_evidence"?"Encrypted Vault":item.type==="bonded_evidence"?"Bonded Evidence":item.source==="device media"?"Device Import":item.source==="telegram"?"Telegram":"Manual Upload","determineEvidenceType"),formatDateRangeForDisplay=__name(groupedByDate=>{const dates=Object.keys(groupedByDate).sort();return dates.length===1?formatDateForDisplay(new Date(dates[0])):dates.length===2?`${formatDateForDisplay(new Date(dates[0]))} and ${formatDateForDisplay(new Date(dates[1]))}`:`${formatDateForDisplay(new Date(dates[0]))} to ${formatDateForDisplay(new Date(dates[dates.length-1]))}`},"formatDateRangeForDisplay"),toggleMenu=__name(()=>setIsMenuOpen(!isMenuOpen),"toggleMenu"),handleCloseUploadModal=__name(()=>setIsUploadModalOpen(!1),"handleCloseUploadModal"),handleExportClick=__name(()=>setIsExportModalOpen(!0),"handleExportClick"),handleCloseExportModal=__name(()=>setIsExportModalOpen(!1),"handleCloseExportModal"),handleTimelineTileClick=__name(date=>navigate(`/timestamp-folder?date=${encodeURIComponent(date)}`),"handleTimelineTileClick"),handleScanMediaClick=__name(()=>setIsMediaScannerOpen(!0),"handleScanMediaClick"),handleCloseMediaScanner=__name(()=>setIsMediaScannerOpen(!1),"handleCloseMediaScanner"),renderTimelineContent=__name(()=>loading||servicesLoading?jsxRuntimeExports.jsx("div",{className:"timeline-loading",children:jsxRuntimeExports.jsxs("div",{className:"timeline-loading-content",children:[jsxRuntimeExports.jsx("div",{className:"timeline-loading-spinner"}),jsxRuntimeExports.jsx("p",{children:"Loading your encrypted timeline..."}),jsxRuntimeExports.jsxs("div",{className:"timeline-loading-progress",children:[jsxRuntimeExports.jsx("div",{className:"progress-bar",children:jsxRuntimeExports.jsx("div",{className:"progress-fill"})}),jsxRuntimeExports.jsx("span",{className:"progress-text",children:isInitialized?"Decrypting evidence...":"Initializing services..."})]})]})}):error?jsxRuntimeExports.jsxs("div",{className:"timeline-error",children:[jsxRuntimeExports.jsx("div",{className:"error-icon",children:"âš ï¸"}),jsxRuntimeExports.jsx("h3",{children:"Timeline Error"}),jsxRuntimeExports.jsx("p",{children:error}),jsxRuntimeExports.jsxs("div",{className:"error-actions",children:[jsxRuntimeExports.jsx("button",{className:"retry-button",onClick:handleRefreshTimeline,children:"Retry Loading"}),jsxRuntimeExports.jsx("button",{className:"fallback-button",onClick:()=>setError(null),children:"Continue Offline"})]})]}):processingEvidence?jsxRuntimeExports.jsx("div",{className:"timeline-processing",children:jsxRuntimeExports.jsxs("div",{className:"processing-content",children:[jsxRuntimeExports.jsx("div",{className:"processing-spinner"}),jsxRuntimeExports.jsx("h3",{children:"Processing Evidence"}),uploadProgress&&jsxRuntimeExports.jsxs("div",{className:"upload-progress",children:[jsxRuntimeExports.jsx("div",{className:"progress-bar",children:jsxRuntimeExports.jsx("div",{className:"progress-fill",style:{width:`${uploadProgress.progress}%`}})}),jsxRuntimeExports.jsxs("span",{className:"progress-text",children:[uploadProgress.stage==="encrypting"&&"Encrypting evidence...",uploadProgress.stage==="hashing"&&"Computing integrity hash...",uploadProgress.stage==="uploading"&&"Uploading to vault...",uploadProgress.stage==="completed"&&"Evidence processed successfully!"]})]})]})}):combinedTimelineData.length===0?jsxRuntimeExports.jsxs("div",{className:"empty-timeline",children:[jsxRuntimeExports.jsx("div",{className:"empty-timeline-icon",children:"ðŸ“…"}),jsxRuntimeExports.jsx("h3",{children:"Your timeline is empty"}),jsxRuntimeExports.jsx("p",{className:"empty-timeline-hint",children:"Start building your relationship evidence by scanning device media or enabling automatic AI processing"}),jsxRuntimeExports.jsxs("div",{className:"empty-timeline-actions",children:[jsxRuntimeExports.jsx("button",{className:"scan-media-button primary",onClick:handleScanMediaClick,children:"Scan Device Media"}),jsxRuntimeExports.jsx("button",{className:"process-evidence-button secondary",onClick:handleProcessEvidenceClick,children:"Process Today's Evidence"}),jsxRuntimeExports.jsx("button",{className:"ai-settings-button tertiary",onClick:()=>navigate("/ai-settings"),children:"Configure AI Settings"})]}),evidenceStats.totalEntries===0&&jsxRuntimeExports.jsxs("div",{className:"getting-started-tip",children:[jsxRuntimeExports.jsx("strong",{children:"ðŸ’¡ Getting Started:"})," Bonded automatically collects and encrypts relationship evidence. Start by importing your photos or enabling AI-powered evidence collection."]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"evidence-stats-bar",children:[jsxRuntimeExports.jsxs("div",{className:"evidence-stats",children:[jsxRuntimeExports.jsxs("div",{className:"stat-item",children:[jsxRuntimeExports.jsx("span",{className:"stat-number",children:evidenceStats.totalEntries}),jsxRuntimeExports.jsx("span",{className:"stat-label",children:"Total Entries"})]}),jsxRuntimeExports.jsxs("div",{className:"stat-item",children:[jsxRuntimeExports.jsx("span",{className:"stat-number",children:evidenceStats.photoEntries}),jsxRuntimeExports.jsx("span",{className:"stat-label",children:"Photos"})]}),jsxRuntimeExports.jsxs("div",{className:"stat-item",children:[jsxRuntimeExports.jsx("span",{className:"stat-number",children:evidenceStats.messageEntries}),jsxRuntimeExports.jsx("span",{className:"stat-label",children:"Messages"})]}),jsxRuntimeExports.jsxs("div",{className:"stat-item",children:[jsxRuntimeExports.jsx("span",{className:"stat-number",children:evidenceStats.documentEntries}),jsxRuntimeExports.jsx("span",{className:"stat-label",children:"Documents"})]})]}),jsxRuntimeExports.jsxs("div",{className:"evidence-actions",children:[jsxRuntimeExports.jsx("button",{className:"refresh-button",onClick:handleRefreshTimeline,title:"Refresh Timeline",children:"ðŸ”„"}),jsxRuntimeExports.jsx("button",{className:"process-button",onClick:handleProcessEvidenceClick,title:"Process Evidence",children:"âš™ï¸"})]})]}),jsxRuntimeExports.jsx("div",{className:"timeline-line",children:jsxRuntimeExports.jsx("div",{className:"timeline-vertical-line",children:combinedTimelineData.map((item,index)=>jsxRuntimeExports.jsx("div",{className:`timeline-dot ${animatedItems.includes(item.id)?"timeline-dot-animated":""} ${item.type==="ai_processed"?"ai-dot":""} ${item.type==="encrypted_evidence"?"encrypted-dot":""}`,style:{top:`${index*200+100}px`}},`dot-${item.id}`))})}),combinedTimelineData.map((item,index)=>item.type==="ai_processed"?jsxRuntimeExports.jsx(AITimelineEntry,{entry:item,onClick:handleTimelineTileClick,className:`timeline-item ${animatedItems.includes(item.id)?"timeline-item-animated":""}`,isAnimated:animatedItems.includes(item.id)},item.id):jsxRuntimeExports.jsxs("div",{className:`timeline-item ${animatedItems.includes(item.id)?"timeline-item-animated":""}`,"data-id":item.id,children:[jsxRuntimeExports.jsxs("div",{className:`date-badge date-badge-${Math.min(index+1,3)}`,children:[jsxRuntimeExports.jsx("div",{className:"date-text",children:item.date||formatDateForDisplay(new Date(item.timestamp))}),item.type==="encrypted_evidence"&&jsxRuntimeExports.jsx("div",{className:"encryption-badge",title:"End-to-end encrypted",children:"ðŸ”’"})]}),jsxRuntimeExports.jsx(TimelineTileWrapper,{className:`timeline-tile-${Math.min(index+1,3)}`,timelineTileText:`${item.messages||0} Messages`,timelineTileText1:`${item.photos||0} Photos`,timelineTileText2:item.location||"Unknown Location",timelineTileIcon:item.icon||(item.messages>0?jsxRuntimeExports.jsx(Chat4,{className:"chat-icon-svg"}):null),timelineTileMaskGroup:item.image,timelineTileMaskGroupClassName:"timeline-brand-image",onClick:handleTimelineTileClick,date:item.date||formatDateForDisplay(new Date(item.timestamp)),source:item.source||"unknown",uploadStatus:item.uploadStatus||"completed",evidenceCategory:determineEvidenceCategory(item),evidenceType:determineEvidenceType(item),aiVerified:item.type==="ai_processed"||item.type==="encrypted_evidence",processTimestamp:`Processed: ${new Date(item.timestamp).toLocaleString()}`,blockchainTimestamp:item.blockchainTimestamp,encryptionHash:item.hash})]},item.id)),jsxRuntimeExports.jsxs("div",{className:"timeline-end",children:[jsxRuntimeExports.jsx("div",{className:"timeline-end-dot"}),jsxRuntimeExports.jsx("p",{className:"timeline-end-text",children:"Keep building your evidence timeline"}),jsxRuntimeExports.jsxs("div",{className:"timeline-end-actions",children:[jsxRuntimeExports.jsx("button",{className:"scan-media-button",onClick:handleScanMediaClick,children:"Scan Device Media"}),jsxRuntimeExports.jsx("button",{className:"process-evidence-button",onClick:handleProcessEvidenceClick,children:"Process Evidence"})]})]})]}),"renderTimelineContent");return jsxRuntimeExports.jsxs("div",{className:"timeline-created",children:[isMenuOpen&&jsxRuntimeExports.jsx(MenuFrame,{onClose:toggleMenu}),isUploadModalOpen&&jsxRuntimeExports.jsx(UploadModal,{onClose:handleCloseUploadModal}),isExportModalOpen&&jsxRuntimeExports.jsx(ExportModal,{onClose:handleCloseExportModal}),isMediaScannerOpen&&jsxRuntimeExports.jsx("div",{className:"media-scanner-modal",children:jsxRuntimeExports.jsxs("div",{className:"media-scanner-container",children:[jsxRuntimeExports.jsxs("div",{className:"media-scanner-header",children:[jsxRuntimeExports.jsx("h2",{children:"Scan Device Media"}),jsxRuntimeExports.jsx("button",{className:"close-button",onClick:handleCloseMediaScanner,children:"Ã—"})]}),jsxRuntimeExports.jsx(MediaScanner,{onMediaSelected:handleMediaSelected})]})}),jsxRuntimeExports.jsxs("div",{className:"timeline-container",children:[jsxRuntimeExports.jsx(TopAppBar,{onMenuToggle:toggleMenu,headline:"Your Immigration Timeline",onScanMediaClick:handleScanMediaClick,onExportClick:handleExportClick}),showImportSuccess&&importedMediaInfo&&jsxRuntimeExports.jsxs("div",{className:"import-success-banner",children:[jsxRuntimeExports.jsx("div",{className:"success-icon",children:"âœ…"}),jsxRuntimeExports.jsxs("div",{className:"success-content",children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Success!"})," ",importedMediaInfo.mediaCount," media files processed and encrypted",importedMediaInfo.dateRange&&` from ${importedMediaInfo.dateRange}`]}),jsxRuntimeExports.jsx("button",{className:"scan-more-button",onClick:handleScanMediaClick,children:"Process More Evidence"})]})]}),isUploadDue&&jsxRuntimeExports.jsxs("div",{className:"upload-due-banner",children:[jsxRuntimeExports.jsx("div",{className:"upload-due-icon",children:"â°"}),jsxRuntimeExports.jsxs("div",{className:"upload-due-content",children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Daily upload due"})," - Ready to process today's evidence?"]}),jsxRuntimeExports.jsx("button",{className:"process-now-button",onClick:handleProcessEvidenceClick,children:"Process Now"})]})]}),jsxRuntimeExports.jsxs("div",{className:"timeline-content-container",children:[jsxRuntimeExports.jsx("div",{className:"timeline-header",children:jsxRuntimeExports.jsxs("div",{className:"frame-header",children:[jsxRuntimeExports.jsx("h1",{className:"capture-title",children:"Immigration Evidence Vault"}),jsxRuntimeExports.jsx("p",{className:"capture-subtitle",children:"Secure, encrypted timeline of your relationship evidence"})]})}),jsxRuntimeExports.jsx("div",{className:"timeline-content",ref:timelineRef,children:renderTimelineContent()})]})]})]})},"TimelineCreated");export{TimelineCreated};
