var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{u as useNavigate,k as useParams,r as reactExports,g as jsxRuntimeExports}from"./vendor-e6e658b6.js";import{M as MediaScanner}from"./MediaScanner-9c55dca2.js";import"./GeoMetadataProvider-1b35b418.js";import{I as InfoModal,D as DeleteModal}from"./DeleteModal-093423ee.js";import"./icp-sdk-b71c0736.js";const TIMELINE_DATA_KEY="bonded_timeline_data",TIMESTAMP_CONTENT_KEY="bonded_timestamp_content",EVIDENCE_CATEGORIES={RELATIONSHIP:"relationship",FINANCIAL:"financial",LANGUAGE:"language",RESIDENCY:"residency",TRAVEL:"travel",DOCUMENT:"document"},TimestampFolder=__name(({onClose,date:propDate})=>{const navigate=useNavigate(),{date:paramDate}=useParams(),[showMediaScannerModal,setShowMediaScannerModal]=reactExports.useState(!1),[showInfoModal,setShowInfoModal]=reactExports.useState(!1),[showDeleteModal,setShowDeleteModal]=reactExports.useState(!1),[selectedItem,setSelectedItem]=reactExports.useState(null),[contentItems,setContentItems]=reactExports.useState([]),[loading,setLoading]=reactExports.useState(!0),[showImportSuccess,setShowImportSuccess]=reactExports.useState(!1),[importedCount,setImportedCount]=reactExports.useState(0),[selectedCategory,setSelectedCategory]=reactExports.useState("all"),date=propDate||(paramDate?decodeURIComponent(paramDate):null);reactExports.useEffect(()=>{date&&__name(()=>{setLoading(!0);try{const allContent=JSON.parse(localStorage.getItem(TIMESTAMP_CONTENT_KEY)||"{}");allContent[date]?setContentItems(allContent[date]):setContentItems([])}catch{setContentItems([])}finally{setLoading(!1)}},"loadContentItems")()},[date]),reactExports.useEffect(()=>{__name(()=>{if(!(!date||contentItems.length===0))try{const allContent=JSON.parse(localStorage.getItem(TIMESTAMP_CONTENT_KEY)||"{}");allContent[date]=contentItems,localStorage.setItem(TIMESTAMP_CONTENT_KEY,JSON.stringify(allContent)),updateTimelineItemCount()}catch{}},"saveContentItems")()},[contentItems,date]);const handleBack=__name(()=>{onClose?onClose():navigate(-1)},"handleBack"),handlePreviewClick=__name(item=>{navigate(`/image-preview/${item.id}`)},"handlePreviewClick"),handleInfoClick=__name(item=>{setSelectedItem(item),setShowInfoModal(!0)},"handleInfoClick"),handleDeleteClick=__name(item=>{setSelectedItem(item),setShowDeleteModal(!0)},"handleDeleteClick"),handleConfirmDelete=__name(item=>{setContentItems(contentItems.filter(i=>i.id!==item.id)),setShowDeleteModal(!1)},"handleConfirmDelete"),updateTimelineItemCount=__name(()=>{try{const timelineData=JSON.parse(localStorage.getItem(TIMELINE_DATA_KEY)||"[]"),entry=timelineData.find(item=>item.date===date);if(entry){const photoCount2=contentItems.filter(item=>item.type==="photo"||item.type==="image").length,messageCount2=contentItems.filter(item=>item.type==="message").length,videoCount2=contentItems.filter(item=>item.type==="video").length,documentCount2=contentItems.filter(item=>item.type==="document").length;if(entry.photos=photoCount2,entry.messages=messageCount2,documentCount2>messageCount2&&documentCount2>photoCount2?entry.evidenceCategory=EVIDENCE_CATEGORIES.DOCUMENT:messageCount2>documentCount2&&messageCount2>photoCount2?entry.evidenceCategory=EVIDENCE_CATEGORIES.LANGUAGE:entry.evidenceCategory=EVIDENCE_CATEGORIES.RELATIONSHIP,photoCount2>0&&!entry.image){const firstPhoto=contentItems.find(item=>item.type==="photo"||item.type==="image");firstPhoto&&firstPhoto.imageUrl&&(entry.image=firstPhoto.imageUrl)}localStorage.setItem(TIMELINE_DATA_KEY,JSON.stringify(timelineData))}}catch{}},"updateTimelineItemCount"),handleScanMedia=__name(()=>{setShowMediaScannerModal(!0)},"handleScanMedia"),handleMediaSelected=__name((selectedFiles,groupedByDate)=>{const filesForThisDate=selectedFiles.filter(file=>new Date(file.timestamp).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})===date);if(filesForThisDate.length===0){alert(`No files found for date: ${date}. Please select files from this exact date.`);return}const newContentItems=filesForThisDate.map(file=>{let fileImageUrl=null;try{file.file instanceof Blob&&(fileImageUrl=URL.createObjectURL(file.file))}catch{}return{id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:getFileType(file.file?.type||"unknown"),name:file.name||"Unknown File",source:"Device Media",location:"Imported",date,imageUrl:fileImageUrl,timestamp:file.timestamp||Date.now(),size:file.size||0,path:file.path||"Unknown",evidenceCategory:determineEvidenceCategory(file.file?.type||"",file.name||""),verified:!1,officialDocument:isLikelyOfficialDocument(file.name||""),metadata:{importDate:new Date().toISOString(),fileType:file.file?.type||"unknown"}}}).filter(item=>item.imageUrl!==null);setContentItems(prevItems=>[...prevItems,...newContentItems]),setShowMediaScannerModal(!1),setImportedCount(newContentItems.length),setShowImportSuccess(!0),setTimeout(()=>{setShowImportSuccess(!1)},3e3),updateTimelineItemCount(newContentItems.length)},"handleMediaSelected"),determineEvidenceCategory=__name((mimeType,fileName)=>{const lowerFileName=fileName.toLowerCase();return lowerFileName.includes("passport")||lowerFileName.includes("visa")||lowerFileName.includes("document")||lowerFileName.includes("certificate")?EVIDENCE_CATEGORIES.DOCUMENT:lowerFileName.includes("bank")||lowerFileName.includes("statement")||lowerFileName.includes("invoice")||lowerFileName.includes("receipt")?EVIDENCE_CATEGORIES.FINANCIAL:lowerFileName.includes("chat")||lowerFileName.includes("message")||lowerFileName.includes("letter")||lowerFileName.includes("email")?EVIDENCE_CATEGORIES.LANGUAGE:lowerFileName.includes("ticket")||lowerFileName.includes("boarding")||lowerFileName.includes("travel")?EVIDENCE_CATEGORIES.TRAVEL:lowerFileName.includes("lease")||lowerFileName.includes("utility")||lowerFileName.includes("address")?EVIDENCE_CATEGORIES.RESIDENCY:EVIDENCE_CATEGORIES.RELATIONSHIP},"determineEvidenceCategory"),isLikelyOfficialDocument=__name(fileName=>{const officialTerms=["passport","visa","certificate","license","official","government","id","document","statement","record"],lowerFileName=fileName.toLowerCase();return officialTerms.some(term=>lowerFileName.includes(term))},"isLikelyOfficialDocument"),getFileType=__name(mimeType=>mimeType.startsWith("image/")?"photo":mimeType.startsWith("video/")?"video":mimeType.startsWith("application/pdf")?"document":"file","getFileType"),handleFilterByCategory=__name(category=>{setSelectedCategory(category)},"handleFilterByCategory"),filteredItems=selectedCategory==="all"?contentItems:contentItems.filter(item=>selectedCategory==="photos"?item.type==="photo":selectedCategory==="videos"?item.type==="video":selectedCategory==="documents"?item.type==="document":selectedCategory==="messages"?item.type==="message":Object.values(EVIDENCE_CATEGORIES).includes(selectedCategory)?item.evidenceCategory===selectedCategory:!0),renderIcon=__name(type=>{switch(type){case"photo":return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M21 19V5C21 3.9 20.1 3 19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19ZM8.5 13.5L11 16.51L14.5 12L19 18H5L8.5 13.5Z",fill:"#FFFFFF"})});case"message":return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H6L4 18V4H20V16Z",fill:"#FFFFFF"})});case"location":return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z",fill:"#FFFFFF"})});case"document":return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M14 2H6C4.9 2 4.01 2.9 4.01 4L4 20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM16 18H8V16H16V18ZM16 14H8V12H16V14ZM13 9V3.5L18.5 9H13Z",fill:"#FFFFFF"})});case"video":return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M17 10.5V7C17 6.45 16.55 6 16 6H4C3.45 6 3 6.45 3 7V17C3 17.55 3.45 18 4 18H16C16.55 18 17 17.55 17 17V13.5L21 17.5V6.5L17 10.5Z",fill:"#FFFFFF"})});default:return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M13 7H11V9H13V7ZM13 11H11V17H13V11ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z",fill:"#FFFFFF"})})}},"renderIcon"),photoCount=contentItems.filter(item=>item.type==="photo").length,videoCount=contentItems.filter(item=>item.type==="video").length,documentCount=contentItems.filter(item=>item.type==="document").length,messageCount=contentItems.filter(item=>item.type==="message").length,totalCount=contentItems.length,evidenceCounts=Object.values(EVIDENCE_CATEGORIES).reduce((acc,category)=>(acc[category]=contentItems.filter(item=>item.evidenceCategory===category).length,acc),{});return jsxRuntimeExports.jsx("div",{className:"timestamp-folder-screen",children:jsxRuntimeExports.jsxs("div",{className:"timestamp-folder-container",children:[jsxRuntimeExports.jsxs("div",{className:"top-app-bar",children:[jsxRuntimeExports.jsxs("div",{className:"frame-14",children:[jsxRuntimeExports.jsx("div",{className:"back-icon",onClick:handleBack,children:jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M15.41 7.41L14 6L8 12L14 18L15.41 16.59L10.83 12L15.41 7.41Z",fill:"#FF704D"})})}),jsxRuntimeExports.jsx("div",{className:"header-title",children:date||"Date not specified"})]}),contentItems.some(item=>item.officialDocument)&&jsxRuntimeExports.jsxs("div",{className:"verification-status",children:[jsxRuntimeExports.jsx("span",{className:"status-indicator"}),"Official Documents Present"]})]}),showImportSuccess&&jsxRuntimeExports.jsx("div",{className:"import-success-notification",children:jsxRuntimeExports.jsxs("p",{children:["✅ Successfully imported ",importedCount," items for ",date]})}),contentItems.length>0&&jsxRuntimeExports.jsxs("div",{className:"filter-chips",children:[jsxRuntimeExports.jsxs("div",{className:`filter-chip ${selectedCategory==="all"?"active":""}`,onClick:()=>handleFilterByCategory("all"),children:["All (",totalCount,")"]}),photoCount>0&&jsxRuntimeExports.jsxs("div",{className:`filter-chip ${selectedCategory==="photos"?"active":""}`,onClick:()=>handleFilterByCategory("photos"),children:["Photos (",photoCount,")"]}),documentCount>0&&jsxRuntimeExports.jsxs("div",{className:`filter-chip ${selectedCategory==="documents"?"active":""}`,onClick:()=>handleFilterByCategory("documents"),children:["Documents (",documentCount,")"]}),messageCount>0&&jsxRuntimeExports.jsxs("div",{className:`filter-chip ${selectedCategory==="messages"?"active":""}`,onClick:()=>handleFilterByCategory("messages"),children:["Messages (",messageCount,")"]}),videoCount>0&&jsxRuntimeExports.jsxs("div",{className:`filter-chip ${selectedCategory==="videos"?"active":""}`,onClick:()=>handleFilterByCategory("videos"),children:["Videos (",videoCount,")"]}),Object.entries(evidenceCounts).map(([category,count])=>count>0&&jsxRuntimeExports.jsxs("div",{className:`filter-chip category-${category} ${selectedCategory===category?"active":""}`,onClick:()=>handleFilterByCategory(category),children:[category," (",count,")"]},category))]}),jsxRuntimeExports.jsxs("div",{className:"timestamp-content",children:[contentItems.length>0&&jsxRuntimeExports.jsxs("div",{className:"media-summary-card",children:[jsxRuntimeExports.jsxs("h3",{children:["Immigration Evidence for ",date]}),jsxRuntimeExports.jsxs("div",{className:"media-counts",children:[photoCount>0&&jsxRuntimeExports.jsxs("div",{className:"count-item",children:[jsxRuntimeExports.jsx("span",{className:"count-number",children:photoCount}),jsxRuntimeExports.jsx("span",{className:"count-label",children:"Photos"})]}),videoCount>0&&jsxRuntimeExports.jsxs("div",{className:"count-item",children:[jsxRuntimeExports.jsx("span",{className:"count-number",children:videoCount}),jsxRuntimeExports.jsx("span",{className:"count-label",children:"Videos"})]}),documentCount>0&&jsxRuntimeExports.jsxs("div",{className:"count-item",children:[jsxRuntimeExports.jsx("span",{className:"count-number",children:documentCount}),jsxRuntimeExports.jsx("span",{className:"count-label",children:"Documents"})]}),messageCount>0&&jsxRuntimeExports.jsxs("div",{className:"count-item",children:[jsxRuntimeExports.jsx("span",{className:"count-number",children:messageCount}),jsxRuntimeExports.jsx("span",{className:"count-label",children:"Messages"})]})]})]}),loading?jsxRuntimeExports.jsxs("div",{className:"loading-indicator",children:[jsxRuntimeExports.jsx("div",{className:"loading-spinner"}),jsxRuntimeExports.jsx("p",{children:"Loading content..."})]}):filteredItems.length===0?jsxRuntimeExports.jsxs("div",{className:"empty-content",children:[jsxRuntimeExports.jsxs("p",{children:["No content ",selectedCategory!=="all"?`for category "${selectedCategory}"`:"available"," for this date"]}),jsxRuntimeExports.jsx("p",{className:"hint-text",children:"Scan your media to add content"})]}):filteredItems.map(item=>jsxRuntimeExports.jsxs("div",{className:`content-row ${item.officialDocument?"official-document":""}`,children:[jsxRuntimeExports.jsxs("div",{className:"row-content",children:[jsxRuntimeExports.jsx("div",{className:"item-icon",children:renderIcon(item.type)}),jsxRuntimeExports.jsxs("div",{className:"item-details",children:[jsxRuntimeExports.jsx("div",{className:"item-name",children:item.name}),jsxRuntimeExports.jsxs("div",{className:"item-meta",children:[item.size&&jsxRuntimeExports.jsx("span",{className:"item-size",children:formatFileSize(item.size)}),jsxRuntimeExports.jsx("span",{className:"item-source",children:item.source}),item.location&&jsxRuntimeExports.jsx("span",{className:"item-location",children:item.location})]}),item.evidenceCategory&&jsxRuntimeExports.jsx("div",{className:`evidence-badge ${item.evidenceCategory}`,children:item.evidenceCategory}),item.officialDocument&&jsxRuntimeExports.jsx("div",{className:"official-badge",children:"Official Document"})]})]}),jsxRuntimeExports.jsxs("div",{className:"row-actions",children:[jsxRuntimeExports.jsx("div",{className:"action-icon preview",onClick:()=>handlePreviewClick(item),children:jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5C17 19.5 21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12C9 13.66 10.34 15 12 15C13.66 15 15 13.66 15 12C15 10.34 13.66 9 12 9Z",fill:"#B9FF46"})})}),jsxRuntimeExports.jsx("div",{className:"action-icon info",onClick:()=>handleInfoClick(item),children:jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM11 17H13V11H11V17ZM11 9H13V7H11V9Z",fill:"#B9FF46"})})}),jsxRuntimeExports.jsx("div",{className:"action-icon delete",onClick:()=>handleDeleteClick(item),children:jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M16 9V19H8V9H16ZM14.5 3H9.5L8.5 4H5V6H19V4H15.5L14.5 3ZM18 7H6V19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7Z",fill:"#FF704D"})})})]})]},item.id)),jsxRuntimeExports.jsx("button",{className:"upload-btn",onClick:handleScanMedia,children:jsxRuntimeExports.jsx("div",{className:"btn-text",children:"Add Immigration Evidence"})})]}),showMediaScannerModal&&jsxRuntimeExports.jsx("div",{className:"media-scanner-modal",children:jsxRuntimeExports.jsxs("div",{className:"media-scanner-container",children:[jsxRuntimeExports.jsxs("div",{className:"media-scanner-header",children:[jsxRuntimeExports.jsxs("h2",{children:["Add Immigration Evidence for ",date]}),jsxRuntimeExports.jsx("button",{className:"close-button",onClick:()=>setShowMediaScannerModal(!1),children:"×"})]}),jsxRuntimeExports.jsx(MediaScanner,{onMediaSelected:handleMediaSelected})]})}),showInfoModal&&jsxRuntimeExports.jsx(InfoModal,{onClose:()=>setShowInfoModal(!1),item:selectedItem}),showDeleteModal&&jsxRuntimeExports.jsx(DeleteModal,{onClose:()=>setShowDeleteModal(!1),onConfirm:()=>handleConfirmDelete(selectedItem),item:selectedItem})]})})},"TimestampFolder"),formatFileSize=__name(bytes=>{if(bytes===0)return"0 Bytes";const sizes=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(bytes)/Math.log(1024));return`${(bytes/Math.pow(1024,i)).toFixed(2)} ${sizes[i]}`},"formatFileSize");export{TimestampFolder};
