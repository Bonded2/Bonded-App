var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{A as AuthClient,_ as __vitePreload}from"./icp-sdk-b71c0736.js";import{u as useNavigate,h as useSearchParams,r as reactExports,g as jsxRuntimeExports,L as Link}from"./vendor-e6e658b6.js";import{C as CustomTextField}from"./CustomTextField-dcd5565c.js";import icpUserService from"./icpUserService-71066c08.js";import"./icpCanisterService-30902200.js";import"./index-ed0f0e28.js";const Register=__name(()=>{const navigate=useNavigate(),[searchParams]=useSearchParams(),[fullName,setFullName]=reactExports.useState(""),[email,setEmail]=reactExports.useState(""),[password,setPassword]=reactExports.useState(""),[errors,setErrors]=reactExports.useState({}),[authClient,setAuthClient]=reactExports.useState(null),[isLoading,setIsLoading]=reactExports.useState(!1),fromInvite=searchParams.get("from")==="invite";reactExports.useEffect(()=>{__name(async()=>{try{const client=await AuthClient.create();setAuthClient(client)}catch{}},"initAuth")()},[]);const handleNameChange=__name(e=>{setFullName(e.target.value)},"handleNameChange"),handleEmailChange=__name(e=>{setEmail(e.target.value)},"handleEmailChange"),handlePasswordChange=__name(e=>{setPassword(e.target.value)},"handlePasswordChange"),handleSubmit=__name(async e=>{e.preventDefault();const newErrors={};if(fullName.trim()||(newErrors.fullName="Name is required"),email.trim()||(newErrors.email="Email is required"),password.trim()||(newErrors.password="Password is required"),Object.keys(newErrors).length>0){setErrors(newErrors);return}if(!authClient){setErrors({submit:"Authentication service not ready. Please refresh the page."});return}setIsLoading(!0),setErrors({});try{const registrationData={fullName,email,password,timestamp:Date.now()},loginOptions={identityProvider:window.location.hostname.includes("icp0.io")?"https://identity.ic0.app":`http://localhost:4943/?canisterId=${{}.INTERNET_IDENTITY_CANISTER_ID||"rdmx6-jaaaa-aaaah-qdrqq-cai"}`,maxTimeToLive:(value=>{try{return typeof value=="string"?parseInt(value,10)||0:Number(value)||0}catch{return 0}})(7*24*60*60*1e3*1e3*1e3),onSuccess:async()=>{try{const identity=authClient.getIdentity(),principal=identity.getPrincipal().toString(),{default:icpCanisterService}=await __vitePreload(()=>import("./icpCanisterService-30902200.js"),["assets/icpCanisterService-30902200.js","assets/icp-sdk-b71c0736.js","assets/vendor-e6e658b6.js","assets/index-ed0f0e28.js"]);if(icpCanisterService.isAuthenticated=!0,icpCanisterService.identity=identity,icpCanisterService.authClient=authClient,await icpCanisterService.createActor(),!icpCanisterService.isAuthenticated)throw new Error("Authentication verification failed after login");if(await icpUserService.initialize(),await icpUserService.registerUser(),fromInvite){const inviteId=new URLSearchParams(window.location.search).get("invite");if(inviteId)try{await icpCanisterService.acceptPartnerInvite(inviteId)}catch{}}if(registrationData){const profileData={fullName:registrationData.fullName,email:registrationData.email,avatar:registrationData.fullName.split(" ").map(part=>part[0]).join("").toUpperCase().slice(0,2),hasBasicInfo:!0,registeredAt:Date.now()};try{await icpUserService.updateUserSettings({profile_metadata:JSON.stringify(profileData)})}catch(saveError){throw console.error("Failed to save profile data to ICP canister:",saveError),new Error("Failed to save registration data to canister")}}navigate(fromInvite?"/profile-setup":"/partner-invite")}catch{setErrors({submit:"Registration successful, but setup failed. Please try again."})}finally{setIsLoading(!1)}},onError:error=>{setErrors({submit:"Internet Identity authentication failed. Please try again."}),setIsLoading(!1)}};await authClient.login(loginOptions)}catch{setErrors({submit:"Failed to start authentication. Please try again."}),setIsLoading(!1)}},"handleSubmit");return jsxRuntimeExports.jsx("div",{className:"register",children:jsxRuntimeExports.jsxs("div",{className:"register-container",children:[jsxRuntimeExports.jsx("img",{className:"bonded-logo-blue",alt:"Bonded logo blue",src:"/images/bonded-logo-blue.svg"}),jsxRuntimeExports.jsx("h1",{className:"create-account-title",children:fromInvite?"Join your partner on Bonded":"Create an account"}),fromInvite&&jsxRuntimeExports.jsxs("div",{className:"invite-banner",children:[jsxRuntimeExports.jsx("div",{className:"invite-icon",children:"üíå"}),jsxRuntimeExports.jsxs("div",{className:"invite-text",children:[jsxRuntimeExports.jsx("div",{className:"invite-title",children:"You've been invited!"}),jsxRuntimeExports.jsx("div",{className:"invite-subtitle",children:"Complete your registration to start building your timeline together"})]})]}),errors.submit&&jsxRuntimeExports.jsxs("div",{className:"error-banner",role:"alert","aria-live":"polite",children:[jsxRuntimeExports.jsx("span",{className:"error-icon",children:"‚ö†Ô∏è"}),errors.submit]}),jsxRuntimeExports.jsxs("form",{className:"register-form",onSubmit:handleSubmit,children:[jsxRuntimeExports.jsx(CustomTextField,{label:"Full Name",placeholder:"Enter your full name",value:fullName,onChange:handleNameChange,required:!0,supportingText:errors.fullName||"It's advisable to use the name on your legal documents.",className:`form-field ${errors.fullName?"input-error":""}`}),jsxRuntimeExports.jsx(CustomTextField,{label:"Email",placeholder:"Enter your email address",type:"email",value:email,onChange:handleEmailChange,required:!0,supportingText:errors.email||" ",className:`form-field ${errors.email?"input-error":""}`}),jsxRuntimeExports.jsx(CustomTextField,{label:"Password",placeholder:"Choose a strong password",type:"password",value:password,onChange:handlePasswordChange,required:!0,supportingText:errors.password||" ",className:`form-field ${errors.password?"input-error":""}`}),jsxRuntimeExports.jsx("button",{type:"submit",className:`create-account-button ${isLoading?"loading":""}`,disabled:isLoading,children:jsxRuntimeExports.jsx("div",{className:"button-layout",children:jsxRuntimeExports.jsxs("div",{className:"button-content",children:[isLoading&&jsxRuntimeExports.jsx("div",{className:"loading-spinner"}),jsxRuntimeExports.jsx("div",{className:"button-label",children:isLoading?"Authenticating...":"Create an account"})]})})})]}),jsxRuntimeExports.jsx("div",{className:"login-redirect",children:jsxRuntimeExports.jsxs("p",{children:["Already have an account? ",jsxRuntimeExports.jsx(Link,{to:"/login",className:"login-link",children:"Log in"})]})})]})})},"Register");export{Register};
