var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{A as AuthClient,_ as __vitePreload}from"./icp-sdk-b71c0736.js";import{r as reactExports,u as useNavigate,g as jsxRuntimeExports,L as Link}from"./vendor-e6e658b6.js";import{C as CustomTextField}from"./CustomTextField-dcd5565c.js";import{u as useBondedServices}from"./useBondedServices-4c833e9c.js";const Login=__name(()=>{const[email,setEmail]=reactExports.useState(""),[password,setPassword]=reactExports.useState(""),[loginMethod,setLoginMethod]=reactExports.useState("email"),[isLoading,setIsLoading]=reactExports.useState(!1),[error,setError]=reactExports.useState(""),[authClient,setAuthClient]=reactExports.useState(null),navigate=useNavigate(),{initializeServices,isInitialized}=useBondedServices();reactExports.useEffect(()=>{__name(async()=>{try{const client=await AuthClient.create();if(setAuthClient(client),await client.isAuthenticated())try{const icpUserServiceModule=await __vitePreload(()=>import("./icpUserService-71066c08.js"),["assets/icpUserService-71066c08.js","assets/icpCanisterService-30902200.js","assets/icp-sdk-b71c0736.js","assets/vendor-e6e658b6.js","assets/index-ed0f0e28.js"]);await icpUserServiceModule.default.initialize();const hasCompletedOnboarding=await icpUserServiceModule.default.hasCompletedOnboarding();navigate(hasCompletedOnboarding?"/timeline":"/partner-invite")}catch{navigate("/partner-invite")}}catch{setError("Authentication service unavailable. Please try again later.")}},"initAuth")()},[navigate]);const handleEmailChange=__name(e=>{setEmail(e.target.value),error&&setError("")},"handleEmailChange"),handlePasswordChange=__name(e=>{setPassword(e.target.value),error&&setError("")},"handlePasswordChange"),handleEmailLogin=__name(async e=>{e.preventDefault(),setIsLoading(!0),setError("");try{if(!email||!password)throw new Error("Please fill in all fields");if(!email.includes("@"))throw new Error("Please enter a valid email address");await new Promise(resolve=>setTimeout(resolve,1500));try{const icpUserServiceModule=await __vitePreload(()=>import("./icpUserService-71066c08.js"),["assets/icpUserService-71066c08.js","assets/icpCanisterService-30902200.js","assets/icp-sdk-b71c0736.js","assets/vendor-e6e658b6.js","assets/index-ed0f0e28.js"]);if(await icpUserServiceModule.default.initialize(),await icpUserServiceModule.default.hasCompletedOnboarding()){try{await initializeServices()}catch{}setTimeout(()=>{navigate("/timeline")},300)}else setTimeout(()=>{navigate("/partner-invite")},300)}catch{setTimeout(()=>{navigate("/partner-invite")},300)}}catch(error2){setError(error2.message||"Login failed. Please check your credentials and try again.")}finally{setIsLoading(!1)}},"handleEmailLogin"),handleICPLogin=__name(async()=>{if(!authClient){setError("Authentication service not ready. Please refresh the page.");return}setIsLoading(!0),setError("");try{const loginOptions={identityProvider:`http://localhost:4943/?canisterId=${{}.INTERNET_IDENTITY_CANISTER_ID}`,maxTimeToLive:(value=>{try{return typeof value=="string"?parseInt(value,10)||0:Number(value)||0}catch{return 0}})(6048e11),onSuccess:async()=>{try{const principal=authClient.getIdentity().getPrincipal().toString();try{const icpUserServiceModule=await __vitePreload(()=>import("./icpUserService-71066c08.js"),["assets/icpUserService-71066c08.js","assets/icpCanisterService-30902200.js","assets/icp-sdk-b71c0736.js","assets/vendor-e6e658b6.js","assets/index-ed0f0e28.js"]);await icpUserServiceModule.default.initialize();const currentUser=await icpUserServiceModule.default.getCurrentUser();if(currentUser&&currentUser.settings&&currentUser.settings.profile_metadata&&JSON.parse(currentUser.settings.profile_metadata).profileComplete){try{await initializeServices()}catch{}navigate("/timeline");return}navigate("/partner-invite")}catch{navigate("/partner-invite")}}catch{setError("Authentication successful, but setup failed. Please try again.")}finally{setIsLoading(!1)}},onError:error2=>{setError("Internet Identity authentication failed. Please try again."),setIsLoading(!1)}};await authClient.login(loginOptions)}catch{setError("Failed to start Internet Identity authentication. Please try again."),setIsLoading(!1)}},"handleICPLogin");return jsxRuntimeExports.jsx("div",{className:"login-screen",children:jsxRuntimeExports.jsxs("div",{className:"login-container",children:[jsxRuntimeExports.jsx("img",{className:"bonded-logo-blue",alt:"Bonded logo blue",src:"/images/bonded-logo-blue.svg"}),jsxRuntimeExports.jsx("h1",{className:"login-title",children:"Welcome back"}),error&&jsxRuntimeExports.jsxs("div",{className:"error-banner",role:"alert","aria-live":"polite",children:[jsxRuntimeExports.jsx("span",{className:"error-icon",children:"⚠️"}),error]}),jsxRuntimeExports.jsxs("div",{className:"login-method-toggle",children:[jsxRuntimeExports.jsx("button",{className:`toggle-button ${loginMethod==="email"?"active":""}`,onClick:()=>setLoginMethod("email"),disabled:isLoading,"aria-pressed":loginMethod==="email",children:"Email & Password"}),jsxRuntimeExports.jsx("button",{className:`toggle-button ${loginMethod==="ii"?"active":""}`,onClick:()=>setLoginMethod("ii"),disabled:isLoading,"aria-pressed":loginMethod==="ii",children:"Secure Login"})]}),jsxRuntimeExports.jsxs("div",{className:"login-options",children:[loginMethod==="email"&&jsxRuntimeExports.jsx("div",{className:"form-container animate-form",children:jsxRuntimeExports.jsxs("form",{onSubmit:handleEmailLogin,className:"login-form",children:[jsxRuntimeExports.jsx(CustomTextField,{label:"Email",placeholder:"Enter your email address",type:"email",value:email,onChange:handleEmailChange,required:!0,className:"form-field"}),jsxRuntimeExports.jsx(CustomTextField,{label:"Password",placeholder:"Enter your password",type:"password",value:password,onChange:handlePasswordChange,required:!0,className:"form-field"}),jsxRuntimeExports.jsx("button",{type:"submit",className:`email-login-button ${isLoading?"loading":""}`,disabled:isLoading||!email||!password,"aria-describedby":error?"login-error":void 0,children:jsxRuntimeExports.jsx("div",{className:"button-layout",children:jsxRuntimeExports.jsxs("div",{className:"button-content",children:[isLoading&&jsxRuntimeExports.jsx("div",{className:"loading-spinner"}),jsxRuntimeExports.jsx("div",{className:"button-label",children:isLoading?"Signing in...":"Login"})]})})})]})}),loginMethod==="ii"&&jsxRuntimeExports.jsxs("div",{className:"ii-container animate-ii",children:[jsxRuntimeExports.jsxs("button",{className:`icp-login-button ${isLoading?"loading":""}`,onClick:handleICPLogin,disabled:isLoading,"aria-label":"Login with Internet Identity","aria-describedby":"ii-info-text",children:[isLoading?jsxRuntimeExports.jsx("div",{className:"loading-spinner"}):jsxRuntimeExports.jsx("img",{src:"/images/icp-logo-button.svg",alt:"Internet Computer",className:"icp-logo"}),isLoading?"Connecting to Secure Login...":"Login with Secure Identity"]}),jsxRuntimeExports.jsx("p",{id:"ii-info-text",className:"ii-info-text",children:isLoading?"Please complete authentication in the popup window...":"You will be redirected to complete secure authentication."})]})]}),jsxRuntimeExports.jsx("div",{className:"login-footer",children:jsxRuntimeExports.jsxs("p",{className:"signup-text",children:["Don't have an account? ",jsxRuntimeExports.jsx(Link,{to:"/register",className:"signup-link",children:"Sign up"})]})})]})})},"Login");export{Login};
