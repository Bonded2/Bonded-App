var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{_ as __vitePreload}from"./icp-sdk-b71c0736.js";import{r as reactExports,g as jsxRuntimeExports}from"./vendor-e6e658b6.js";const PWAInstallPrompt=__name(()=>{const[installPromptEvent,setInstallPromptEvent]=reactExports.useState(null),[showPrompt,setShowPrompt]=reactExports.useState(!1),[isIOS,setIsIOS]=reactExports.useState(!1),[isStandalone,setIsStandalone]=reactExports.useState(!1),[isAndroid,setIsAndroid]=reactExports.useState(!1),[browserInfo,setBrowserInfo]=reactExports.useState(""),[isDismissedRecently,setIsDismissedRecently]=reactExports.useState(null),[showIOSGuide,setShowIOSGuide]=reactExports.useState(!1),[guidedInstallStep,setGuidedInstallStep]=reactExports.useState(0),[isInstalling,setIsInstalling]=reactExports.useState(!1),[userInteraction,setUserInteraction]=reactExports.useState({hasInteracted:!1,dismissCount:0,lastDismissed:null,installAttempts:0}),iosInstallSteps=[{title:"Tap the Share Button",description:"Look for the share icon at the bottom of Safari",icon:"â†—",detail:"It's usually in the center of the bottom toolbar"},{title:"Scroll and Find 'Add to Home Screen'",description:"Scroll through the options until you see this",icon:"ðŸ“²",detail:"It has a small plus icon next to it"},{title:"Tap 'Add'",description:"Confirm by tapping 'Add' in the top right",icon:"âœ“",detail:"The app will appear on your home screen"}];reactExports.useEffect(()=>{const iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;setIsIOS(iOS);const android=/Android/.test(navigator.userAgent);setIsAndroid(android);const standalone=window.navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches;setIsStandalone(standalone),setBrowserInfo(__name(()=>{const ua=navigator.userAgent;return/CriOS/i.test(ua)?"Chrome on iOS":/FxiOS/i.test(ua)?"Firefox on iOS":/EdgiOS/i.test(ua)?"Edge on iOS":/OPiOS/i.test(ua)?"Opera on iOS":/SamsungBrowser/i.test(ua)?"Samsung Browser":/Chrome/i.test(ua)?"Chrome":/Firefox/i.test(ua)?"Firefox":/Safari/i.test(ua)?"Safari":/Edge/i.test(ua)?"Edge":/Opera/i.test(ua)?"Opera":"Unknown Browser"},"getBrowserInfo")());const handleBeforeInstallPrompt=__name(e=>{e.preventDefault(),setInstallPromptEvent(e),setTimeout(()=>{setShowPrompt(!0)},3e3)},"handleBeforeInstallPrompt");return window.addEventListener("beforeinstallprompt",handleBeforeInstallPrompt),__name(async()=>{try{const lastDismissed=localStorage.getItem("pwaPromptDismissed"),dismissedTime=lastDismissed?parseInt(lastDismissed,10):0,oneDayAgo=Date.now()-24*60*60*1e3;if(setIsDismissedRecently(dismissedTime>oneDayAgo),!lastDismissed)try{const{canisterLocalStorage}=await __vitePreload(()=>import("./realCanisterStorage-e1d3a70a.js"),["assets/realCanisterStorage-e1d3a70a.js","assets/canisterIntegration-a5c53e9e.js","assets/vendor-e6e658b6.js","assets/icp-sdk-b71c0736.js","assets/index-ed0f0e28.js","assets/icpNetworkHelper-2c245b46.js","assets/emailService-11bba984.js"]),canisterDismissed=await canisterLocalStorage.getItem("pwaPromptDismissed");if(canisterDismissed){const canisterDismissedTime=parseInt(canisterDismissed,10);setIsDismissedRecently(canisterDismissedTime>oneDayAgo)}}catch{}}catch{setIsDismissedRecently(!1)}},"checkDismissalStatus")(),setTimeout(()=>{standalone||(iOS&&/Safari/i.test(navigator.userAgent)&&!/CriOS/i.test(navigator.userAgent)&&setShowPrompt(!0),android&&/SamsungBrowser/i.test(navigator.userAgent)&&setShowPrompt(!0))},5e3),()=>{window.removeEventListener("beforeinstallprompt",handleBeforeInstallPrompt)}},[]);const handleInstallClick=__name(async()=>{if(setUserInteraction(prev=>({...prev,hasInteracted:!0})),installPromptEvent){setIsInstalling(!0);try{if(installPromptEvent.prompt(),(await installPromptEvent.userChoice).outcome==="accepted"){const attempts=JSON.parse(localStorage.getItem("bonded_pwa_attempts")||'{"count": 0}');localStorage.setItem("bonded_pwa_attempts",JSON.stringify({count:attempts.count+1,lastSuccess:Date.now()}))}setInstallPromptEvent(null),setShowPrompt(!1)}catch(error){console.warn("PWA installation failed:",error)}finally{setIsInstalling(!1)}}else isIOS?(setShowIOSGuide(!0),setGuidedInstallStep(0)):isAndroid&&alert('To install this app, tap the menu button and select "Add to Home screen" or "Install App"')},"handleInstallClick"),handleDismissClick=__name(async()=>{setShowPrompt(!1);const newDismissalData={count:JSON.parse(localStorage.getItem("bonded_pwa_dismissals")||'{"count": 0}').count+1,timestamp:Date.now()};try{localStorage.setItem("pwaPromptDismissed",Date.now().toString()),localStorage.setItem("bonded_pwa_dismissals",JSON.stringify(newDismissalData)),setUserInteraction(prev=>({...prev,dismissCount:newDismissalData.count,lastDismissed:newDismissalData.timestamp}));try{const{canisterLocalStorage}=await __vitePreload(()=>import("./realCanisterStorage-e1d3a70a.js"),["assets/realCanisterStorage-e1d3a70a.js","assets/canisterIntegration-a5c53e9e.js","assets/vendor-e6e658b6.js","assets/icp-sdk-b71c0736.js","assets/index-ed0f0e28.js","assets/icpNetworkHelper-2c245b46.js","assets/emailService-11bba984.js"]);await canisterLocalStorage.setItem("pwaPromptDismissed",Date.now().toString()),await canisterLocalStorage.setItem("bonded_pwa_dismissals",JSON.stringify(newDismissalData))}catch{}}catch{}},"handleDismissClick");return isStandalone||!showPrompt||isDismissedRecently===null||isDismissedRecently===!0?null:jsxRuntimeExports.jsxs("div",{className:`pwa-install-prompt ${isIOS?"ios-prompt":""} ${isAndroid?"android-prompt":""}`,children:[jsxRuntimeExports.jsxs("div",{className:"pwa-prompt-content",children:[jsxRuntimeExports.jsx("div",{className:"pwa-prompt-icon",children:jsxRuntimeExports.jsx("img",{src:"/images/icon-192x192.png",alt:"Bonded App Icon"})}),jsxRuntimeExports.jsxs("div",{className:"pwa-prompt-text",children:[jsxRuntimeExports.jsx("h3",{children:"Install Bonded App"}),jsxRuntimeExports.jsx("p",{children:"Securely timestamp your relationship evidence for immigration applications"})]}),jsxRuntimeExports.jsx("div",{className:"pwa-prompt-benefits",children:jsxRuntimeExports.jsxs("ul",{children:[jsxRuntimeExports.jsx("li",{children:"Capture evidence even offline"}),jsxRuntimeExports.jsx("li",{children:"Get secure verification timestamps"}),jsxRuntimeExports.jsx("li",{children:"Faster access to your timeline"}),jsxRuntimeExports.jsx("li",{children:"Private, encrypted storage"})]})}),isIOS&&jsxRuntimeExports.jsx("div",{className:"pwa-ios-instructions",children:jsxRuntimeExports.jsxs("p",{children:["Tap ",jsxRuntimeExports.jsx("span",{className:"ios-share-icon",children:"â†—"}),' then "Add to Home Screen"']})}),jsxRuntimeExports.jsxs("div",{className:"pwa-prompt-actions",children:[jsxRuntimeExports.jsx("button",{className:"pwa-dismiss-btn",onClick:handleDismissClick,children:"Not Now"}),jsxRuntimeExports.jsx("button",{className:"pwa-install-btn",onClick:handleInstallClick,disabled:isInstalling,children:isInstalling?"Installing...":isIOS?"Show Me How":"Install"})]})]}),showIOSGuide&&jsxRuntimeExports.jsx("div",{className:"ios-install-guide-overlay",onClick:()=>setShowIOSGuide(!1),children:jsxRuntimeExports.jsxs("div",{className:"ios-install-guide",onClick:e=>e.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"guide-header",children:[jsxRuntimeExports.jsx("h2",{children:"Install Bonded on iOS"}),jsxRuntimeExports.jsx("button",{className:"close-guide",onClick:()=>setShowIOSGuide(!1),children:"Ã—"})]}),jsxRuntimeExports.jsx("div",{className:"guide-steps",children:iosInstallSteps.map((step,index)=>jsxRuntimeExports.jsxs("div",{className:`guide-step ${index===guidedInstallStep?"active":""} ${index<guidedInstallStep?"completed":""}`,children:[jsxRuntimeExports.jsx("div",{className:"step-number",children:index+1}),jsxRuntimeExports.jsx("div",{className:"step-icon",children:step.icon}),jsxRuntimeExports.jsxs("div",{className:"step-content",children:[jsxRuntimeExports.jsx("h3",{children:step.title}),jsxRuntimeExports.jsx("p",{children:step.description}),jsxRuntimeExports.jsx("small",{children:step.detail})]})]},index))}),jsxRuntimeExports.jsxs("div",{className:"guide-actions",children:[jsxRuntimeExports.jsx("button",{className:"guide-prev-btn",onClick:()=>setGuidedInstallStep(Math.max(0,guidedInstallStep-1)),disabled:guidedInstallStep===0,children:"Previous"}),jsxRuntimeExports.jsx("button",{className:"guide-next-btn",onClick:()=>{guidedInstallStep<iosInstallSteps.length-1?setGuidedInstallStep(guidedInstallStep+1):setShowIOSGuide(!1)},children:guidedInstallStep<iosInstallSteps.length-1?"Next":"Done"})]})]})})]})},"PWAInstallPrompt");export{PWAInstallPrompt};
