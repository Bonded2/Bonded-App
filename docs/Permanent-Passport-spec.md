**Permanent Passport Spec

Overview**
When a Bonded user closes their account, they are given the option to take their relationship data with them, in the form of a cryptographically-verifiable timeline (called the POHR passport). To ensure this timeline cannot be faked or altered after the fact, Bonded performs a one-time attestation before deleting the user's canister. This attestation proves that the timeline originated from the Internet Computer (ICP) and was created by a specific Bonded canister. It uses zero-knowledge proofs (ZKPs) generated via Midnight and is permanently archived on Alternative Storage. The ZKP proves that the timeline came from real, untampered ICP data, and an official certificate from the Internet Computer (signed by boundary nodes) confirms that the input data existed on-chain before the canister was deleted. The final bundle is self-contained, verifiable by anyone, and includes a timestamped Alternative Storage record.

**Specification**
Phase 1: Timeline Generation and Certification (while ICP canister still exists)
1.	Data Commitment Query
The Bonded canister is queried for the relationship's data commitment hash (H_input).
  o	This returns the hash H_input and an ICP boundary-node-signed certificate proving that the canister held that data.
2.	Timeline File Generation
  o	The canister generates a timeline document (T) from its stable memory.
  o	This timeline includes ICP timestamps and relevant metadata.
  o	The document is hashed to produce H_timeline = SHA256(T).
3.	Zero-Knowledge Proof Generation (Midnight)
  o	A Midnight-compatible ZK proof is generated off-chain.
  o	The witness includes all private ICP data used to generate the timeline.
  o	The proof demonstrates:
a. The data used (E) hashes to H_input
b. The timeline T is the canonical output of E using known logic
c. The timeline hashes to H_timeline
4.	Final PDF Assembly
  o	The timeline is exported as a PDF/A-3 file.
  o	Metadata fields are used to embed H_timeline and public inputs.
  o	The ZK proof blob is attached to the PDF.
  o	The ICP certificate is also embedded or attached.
5.	Package Assembly
A full verification package is assembled containing:
  o	The PDF/A-3 timeline file
  o	H_timeline
  o	ZKP blob
  o	ZKP public inputs (including H_input)
  o	Verifier program identifier
  o	ICP certificate proving H_input
6.	Upload to Alternative Storage
  o	The full package is uploaded to an alternative storage cosen by the client.

**Technical Specification (Suggested Code – to be checked)**
{
  "timeline_file": "<base64-encoded PDF/A-3>",
  "timeline_hash": "H_timeline",
  "zkp_proof_blob": "<Midnight ZKP blob>",
  "public_inputs": {
    "H_timeline": "...",
    "H_input": "...",
    "canister_id": "abcd-rzya",
    "relationship_id": "rel-912b",
    "timestamp_range": ["2025-04-01", "2025-07-01"],
    "version": "timeline_logic_v2.1"
  },
  "verifier_program_id": "CompactVerifier_v2",
  "attestation_certificate": {
    "H_input": "...",
    "canister_id": "abcd-rzya",
    "boundary_signature": "<chain key signature>",
    "timestamp": "2025-08-05T00:00Z",
    "tree": "...",
    "witness": "...",
    "delegation": "..."
  },

}
•	The PDF includes embedded metadata:
  o	pdf.metadata.proof_hash = H_timeline
  o	pdf.attachments.zk_proof = zkp_proof_blob
  o	pdf.attachments.icp_certificate = attestation_certificate
•	A verifier uses:
  o	SHA256(timeline_file) to confirm it matches H_timeline
  o	Midnight’s verifier tool with the blob and public inputs
  o	Boundary node certificate to verify H_input existed on ICP
Result: A verifiable, cryptographically anchored, and permanently archived POHR passport that does not rely on Bonded infrastructure for future validation.

**Verifier’s Step-by-Step Guide**
Purpose: To confirm that a timeline file (the POHR passport) was:
•	Generated by the Bonded app from real relationship data stored on the Internet Computer (ICP)
•	Not modified after generation
•	Archived permanently on Alternative Storage
•	Verified using a cryptographic ZK proof and an ICP-issued certificate

What You Are Verifying
You have been provided with one of the following:
•	A PDF file containing embedded verification metadata
OR
•	A ZIP or JSON bundle downloaded from the alternative storage
The package contains:
1.	The timeline document (PDF or JSON)
2.	The SHA-256 hash of that document (H_timeline)
3.	A Midnight ZK proof blob
4.	The public inputs used in the proof
5.	An ICP certificate attesting to the original data commitment (H_input)
6.	The Midnight verifier program ID

Steps for Manual or Programmatic Verification
Step 1: Verify File Hash
•	Recalculate the SHA-256 hash of the timeline_file
•	Confirm that it matches H_timeline in the public inputs
bash
CopyEdit
sha256sum timeline_file.pdf
Success if the hash matches H_timeline

Step 2: Run the Midnight Verifier
•	Use the Midnight-provided verifier binary or tool
•	Input:
  o	zkp_proof_blob
  o	public_inputs
  o	verifier_program_id
The verifier will evaluate:
•	That the private data used to generate the timeline:
  o	Was consistent with the ICP-committed hash (H_input)
  o	Produced the correct output (H_timeline)
•	That all constraint logic passed (e.g. timestamp consistency, formatting rules)
Success if the verifier outputs TRUE or PASS

Step 3: Verify the ICP Certificate
•	Validate the attestation_certificate using the DFINITY Chain Key
•	Use a trusted tool (e.g. DFX or certified-data verifier) to verify:
  o	The certificate's boundary node signature
  o	That it contains the H_input claimed in the ZKP
  o	That the canister ID is legitimate
  o	That the timestamp reflects a generation time prior to canister deletion
Success if:
•	The certificate is valid
•	It matches the claimed H_input
•	The timestamp is before the Alternative Storage upload

Overall Verification Passes If:
Condition	
timeline_file hash matches H_timeline	
Midnight ZK proof validates public inputs	
ICP certificate is cryptographically valid and contains H_input	
H_input matches the hash used in the proof	
Timeline creation and archive times are consistent	

**Example Summary Statement (Verifier Can Write):**
“I have verified that the POHR passport document archived on Alternative Storage is an unaltered reproduction of a timeline file generated by a Bonded canister on the Internet Computer. Its integrity is confirmed by a zero-knowledge proof issued through Midnight and a certificate signed by the ICP Chain Key at the time of generation.”


**ZKP Constraint Specification**
Purpose: Define the logic and binding rules for the zero-knowledge proof that certifies the POHR passport originated from verifiable ICP data and was faithfully rendered.

Constraint System Name
POHR_ProofSystem_v2.1

**Overview**
The proof must show that:
1.	The timeline file (T) is derived from relationship data (E)
2.	The data (E) is consistent with the ICP-signed commitment hash (H_input)
3.	The file T hashes to a known public hash (H_timeline)
4.	The proof uses approved logic version (e.g. timeline_logic_v2.1)

Inputs
Private (Witness) Inputs:
•	E: Relationship data extracted from stable memory, including:
o	Events (with timestamps)
o	AI outputs or filtering scores
o	Uploaded evidence references
•	Any internal metadata (e.g. session IDs, partner IDs)
Public Inputs:
•	H_input: Hash of E, as published in the ICP certificate
•	H_timeline: SHA-256 hash of the final timeline document
•	relationship_id
•	canister_id
•	timestamp_range: [start, end]
•	version: Expected processing logic version (e.g. timeline_logic_v2.1)

**Constraints to Enforce**
Constraint 1: Input Authenticity
plaintext
CopyEdit
SHA256(E) == H_input
•	Ensures the data used in the proof matches what was signed by the ICP boundary node

Constraint 2: Canonical Timeline Generation
plaintext
CopyEdit
T := Render(E, version)
•	Applies the public version of the logic
•	Rendering includes:
o	Chronological sorting of events
o	Inclusion of partner metadata and dates
o	Embedding of original ICP timestamps

Constraint 3: Timeline Hash Binding
plaintext
CopyEdit
SHA256(T) == H_timeline
•	Proves the document uploaded to Alternative Storage is a faithful product of step 2

Constraint 4: Timeline Metadata Check
plaintext
CopyEdit
Extracted timestamps in T ⊆ timestamp_range
•	Timeline must only include events within the claimed range

Verifier Must Accept Proof Only If:
•	All constraints pass
•	Public inputs match the values stored in the attestation certificate and Alternative Storage record

**Implementation Notes**
•	Rendering logic Render(E, version) must be deterministic
•	ZK circuit should be versioned and published alongside CompactVerifier_v2
•	If the format evolves, new constraint systems (e.g. POHR_ProofSystem_v3.0) must be versioned separately



